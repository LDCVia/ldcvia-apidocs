<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>LDC Via API Reference</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
      <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["java","javascript"]);
        });
      </script>
  </head>

  <body class="index">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" />
      </span>
    </a>
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="lang-selector">
              <a href="#" data-language-name="java">java</a>
              <a href="#" data-language-name="javascript">javascript</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='http://ldcvia.com'>Find out more about LDC Via</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="introduction">Introduction</h1>

<p>Welcome to the LDC Via API! You can use our API to access LDC Via API endpoints, this allows you to access and modify documents within databases in your organisation.</p>

<p>We have language bindings in Java and JavaScript (jQuery)! You can view code examples in the dark area to the right, and you can switch the programming language of the examples with the tabs in the top right.</p>

<p>The video below shows how to get your API key:
<iframe src="//player.vimeo.com/video/113910972" width="500" height="281" frameborder="0" allowfullscreen=""></iframe></p>

<h1 id="authentication">Authentication</h1>

<blockquote>
<p>To authorize, always pass the &lsquo;apikey&rsquo; HTTP header:</p>
</blockquote>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpGet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Get a list of databases that the current user has access to
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="n">JsonJavaArray</span> <span class="nf">getDatabases</span><span class="p">(</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">loadURL</span><span class="o">(</span><span class="s">"/1.0/databases"</span><span class="o">);</span>
    <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
    <span class="n">JsonJavaObject</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaObject</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="na">getAsArray</span><span class="o">(</span><span class="s">"databases"</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to request a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">loadURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpGet</span> <span class="n">httpget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
    <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="s1">'apikey'</span><span class="p">:</span> <span class="s1">'MYSECRETAPIKEY'</span> <span class="p">},</span>
    <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/databases'</span><span class="p">,</span>
    <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">){</span>
      <span class="c1">//Do something</span>
    <span class="p">}</span>
  <span class="p">});</span>
</code></pre>

<blockquote>
<p>Make sure to replace <code class="prettyprint">MYSECRETAPIKEY</code> with your API key.</p>
</blockquote>

<p>Each user in the application is assigned an API Key when they are registered. This key is unique and should be considered a secret (i.e. do not share your key with anyone else). Your API Key is required for all interactions with the API, without the key, or with an incorrect key you will not be able to access the API.</p>

<p><code class="prettyprint">apikey: INSERTYOURAPIKEYHERE</code></p>

<aside class="notice">
You must replace `INSERTYOURAPIKEYHERE` with your personal API key.
</aside>

<h2 id="login">Login</h2>

<p>We provide a simple login API to which you can pass a username and password, if they are valid then the matching API key will be returned with which you will be able to perform operations against the rest of the API.</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpPost</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.entity.StringEntity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Get the API key for the user
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">login</span><span class="p">(</span><span class="n">String</span> <span class="n">username</span><span class="o">,</span> <span class="n">String</span> <span class="n">password</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">postURL</span><span class="o">(</span><span class="s">"/1.0/login"</span><span class="o">,</span> <span class="s">"{\"username\": "</span> <span class="o">+</span> <span class="n">username</span> <span class="o">+</span> <span class="s">", \"password\": "</span> <span class="o">+</span> <span class="n">password</span> <span class="o">+</span> <span class="s">"}"</span><span class="o">);</span>
    <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
    <span class="n">JsonJavaObject</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaObject</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to post data to a URL from the LDC Via service
 * @param url
 * @param data
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">postURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">data</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpPost</span> <span class="n">httppost</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpPost</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>
  <span class="n">StringEntity</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringEntity</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
    <span class="n">input</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">);</span>
    <span class="n">httppost</span><span class="o">.</span><span class="na">setEntity</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httppost</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span><span class="s1">'username'</span><span class="p">:</span> <span class="s2">"fred@bloggs.com"</span><span class="p">,</span> <span class="s1">'password'</span><span class="p">:</span> <span class="s1">'SuperSecretPassword'</span><span class="p">};</span>
<span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="s1">'https://eu.ldcvia.com'</span><span class="p">;</span>
  <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
    <span class="na">type</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="nx">root</span> <span class="o">+</span> <span class="s1">'/1.0/login'</span><span class="p">,</span>
    <span class="na">data</span><span class="p">:</span> <span class="nx">data</span><span class="p">,</span>
    <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">})</span>
</code></pre>

<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"apikey"</span><span class="p">:</span><span class="s2">"d656cafda863458c78219760cb0ef4d1"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"fred@bloggs.com"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"roles"</span><span class="p">:{</span><span class="s2">"account"</span><span class="p">:</span><span class="s2">"54be76b40f0f0ce80fe9b21e"</span><span class="p">},</span><span class="w">
  </span><span class="s2">"notesnames"</span><span class="p">:[],</span><span class="w">
  </span><span class="s2">"databases"</span><span class="p">:</span><span class="w">
    </span><span class="p">[</span><span class="w">
      </span><span class="p">{</span><span class="s2">"database"</span><span class="p">:</span><span class="s2">"dev-londc-com-teamroom-nsf"</span><span class="p">,</span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"54be770c0f0f0ce80fe9b220"</span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="s2">"database"</span><span class="p">:</span><span class="s2">"dev-londc-com-teamroom-nsf"</span><span class="p">,</span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"54be7ce40f0f0ce80fe9b221"</span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="s2">"database"</span><span class="p">:</span><span class="s2">"dev-londc-com-teamroom-nsf"</span><span class="p">,</span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"54c66b660f0f0ce80fe9b24b"</span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="s2">"database"</span><span class="p">:</span><span class="s2">"dev-londc-com-teamroom-nsf"</span><span class="p">,</span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"54d13776b8fcbdac0bee24f5"</span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This endpoint retrieves all databases that you have access to.</p>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">POST http://eu.ldcvia.com/1.0/login</code></p>

<h1 id="databases">Databases</h1>

<p>This is probably the simplest API method that we offer, it provides a simple list of databases that a user has access to.</p>

<h2 id="get-all-databases">Get All Databases</h2>
<pre><code class="highlight java"><span class="cm">/**
 * Get a list of databases that the current user has access to
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="n">JsonJavaArray</span> <span class="nf">getDatabases</span><span class="p">(</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">loadURL</span><span class="o">(</span><span class="s">"/1.0/databases"</span><span class="o">);</span>
    <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
    <span class="n">JsonJavaObject</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaObject</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="na">getAsArray</span><span class="o">(</span><span class="s">"databases"</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to request a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">loadURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpGet</span> <span class="n">httpget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="s1">'https://eu.ldcvia.com'</span><span class="p">;</span>
  <span class="kd">var</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="s1">'MYSECRETAPIKEY'</span><span class="p">;</span>
  <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
    <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="nx">root</span> <span class="o">+</span> <span class="s1">'/1.0/databases'</span><span class="p">,</span>
    <span class="na">data</span><span class="p">:</span> <span class="nx">data</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
      <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
    <span class="p">},</span>
    <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">})</span>
</code></pre>

<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"databases"</span><span class="p">:[</span><span class="w">
    </span><span class="p">{</span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"acme-com-discussion1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Discussion 1"</span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"acme-com-discussion2"</span><span class="p">,</span><span class="w"> </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Discussion 2"</span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>This endpoint retrieves all databases that you have access to.</p>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET http://eu.ldcvia.com/1.0/databases</code></p>

<h2 id="get-database-details">Get Database Details</h2>

<p>Use this method to get basic information about a database; its title and whether it is read only.</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpGet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Get a list of databases that the current user has access to
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">getDatabaseTitle</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">loadURL</span><span class="o">(</span><span class="s">"/1.0/database/"</span> <span class="o">+</span> <span class="n">dbname</span><span class="o">);</span>
    <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
    <span class="n">JsonJavaObject</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaObject</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="na">getAsString</span><span class="o">(</span><span class="s">"title"</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to request a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">loadURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpGet</span> <span class="n">httpget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span> <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/database/'</span> <span class="o">+</span> <span class="nx">database</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">){</span>
    <span class="c1">//do something</span>
  <span class="p">},</span>
  <span class="nx">error</span><span class="err">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">error</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">401</span><span class="p">){</span>
      <span class="nx">alert</span><span class="p">(</span><span class="s2">"You do not have the rights to access the database"</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="nx">alert</span><span class="p">(</span><span class="nx">status</span> <span class="o">+</span> <span class="s1">'\n'</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>

<blockquote>
<p>If you have access to the database you will see:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"db"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dev-londc-com-demos-fakenames-nsf"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"readonly"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="s2">"indexed"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="s2">"publicaccess"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w">
  </span><span class="s2">"created"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-07-01T00:00:00.000Z"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"title"</span><span class="p">:</span><span class="w"> </span><span class="s2">"NAB"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/database/:database</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service</td>
</tr>
</tbody></table>

<h2 id="set-database-details">Set Database Details</h2>

<p>Use this method to make a database read only or change its title</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpPost</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.entity.StringEntity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Get a list of databases that the current user has access to
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">setDatabaseTitle</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">,</span> <span class="n">String</span> <span class="n">title</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">postURL</span><span class="o">(</span><span class="s">"/1.0/database/"</span> <span class="o">+</span> <span class="n">dbname</span><span class="o">,</span> <span class="s">"{\"title\": "</span> <span class="o">+</span> <span class="n">title</span> <span class="o">+</span> <span class="s">"}"</span><span class="o">);</span>
    <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
    <span class="n">JsonJavaObject</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaObject</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to post data to a URL from the LDC Via service
 * @param url
 * @param data
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">postURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">data</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpPost</span> <span class="n">httppost</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpPost</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>
  <span class="n">StringEntity</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringEntity</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
    <span class="n">input</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">);</span>
    <span class="n">httppost</span><span class="o">.</span><span class="na">setEntity</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httppost</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httppost</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="s2">"readonly=true&amp;title=New Title"</span><span class="p">;</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
  <span class="na">data</span><span class="p">:</span> <span class="nx">data</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span> <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/database/'</span> <span class="o">+</span> <span class="nx">database</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">){</span>
    <span class="c1">//do something</span>
  <span class="p">},</span>
  <span class="nx">error</span><span class="err">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">error</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">401</span><span class="p">){</span>
      <span class="nx">alert</span><span class="p">(</span><span class="s2">"You do not have the rights to access the database"</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="nx">alert</span><span class="p">(</span><span class="nx">status</span> <span class="o">+</span> <span class="s1">'\n'</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>

<blockquote>
<p>If you can delete the database you will see:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ok"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/database/:database</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service</td>
</tr>
</tbody></table>

<h2 id="delete-entire-database">Delete Entire Database</h2>

<p>Use this method to delete a database. You must be a super user to perform this operation, otherwise you will receive a 401 error.</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpDelete</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Get a list of databases that the current user has access to
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteDatabase</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">deleteURL</span><span class="o">(</span><span class="s">"/1.0/database/"</span> <span class="o">+</span> <span class="n">dbname</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to delete a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">deleteURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpDelete</span> <span class="n">httpdelete</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpDelete</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'DELETE'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span> <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/database/'</span> <span class="o">+</span> <span class="nx">database</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">){</span>
    <span class="c1">//do something</span>
  <span class="p">},</span>
  <span class="nx">error</span><span class="err">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">error</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">401</span><span class="p">){</span>
      <span class="nx">alert</span><span class="p">(</span><span class="s2">"You do not have the rights to delete the database"</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="nx">alert</span><span class="p">(</span><span class="nx">status</span> <span class="o">+</span> <span class="s1">'\n'</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">});</span>
</code></pre>

<blockquote>
<p>If you can delete the database you will see:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ok"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">DELETE https://eu.ldcvia.com/1.0/database/:database</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service</td>
</tr>
</tbody></table>

<h1 id="collections">Collections</h1>

<p>A collection in LDC Via is a group of documents that are all of the same type. In Notes and Domino terms it&rsquo;s very similar to a view. As an example, if we were to migrate a Discussion database from Notes to LDC Via, you would end up with three collections: MainTopic, Response and ResponseToResponse. There is nothing to stop documents in the same collection having different fields on them, but when we maintain meta data at a collection level we assume that all documents in the same collection could have the same fields on them.</p>

<h2 id="get-all-collections-in-a-database">Get All Collections in a Database</h2>

<p>Given a database name, this method will return a list of all collections in the database along with a count of documents in each collection.</p>

<p>The counts of the documents have document level security applied to them, so if there are 100 documents in the collection but the user can see only 10, then the count will be 10.</p>
<pre><code class="highlight java"><span class="cm">/**
 * Gets a list of collections for the given database
 * Each element contains two properties: collection and count. Count is relative to the api key used to get the collection list
 * @param dbname
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">ArrayList</span> <span class="nf">getCollections</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">loadURL</span><span class="o">(</span><span class="s">"/1.0/collections/"</span> <span class="o">+</span> <span class="n">dbname</span><span class="o">);</span>

    <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
    <span class="n">ArrayList</span> <span class="n">list</span> <span class="o">=</span> <span class="o">(</span><span class="n">ArrayList</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>
    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="k">new</span> <span class="n">CollectionComparator</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to request a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">loadURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpGet</span> <span class="n">httpget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="s1">'https://eu.ldcvia.com'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="s1">'MYSECRETAPIKEY'</span><span class="p">;</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">url</span><span class="p">:</span> <span class="nx">root</span> <span class="o">+</span> <span class="s1">'/1.0/collections/'</span> <span class="o">+</span> <span class="nx">dbname</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"collection"</span><span class="p">:</span><span class="s2">"Response"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"count"</span><span class="p">:</span><span class="mi">5</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"collection"</span><span class="p">:</span><span class="s2">"ResponseToResponse"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"count"</span><span class="p">:</span><span class="mi">7</span><span class="w">  
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"collection"</span><span class="p">:</span><span class="s2">"MainTopic"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"count"</span><span class="p">:</span><span class="mi">1</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/collections/:database</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service</td>
</tr>
</tbody></table>

<h2 id="get-all-documents-in-a-collection">Get All Documents In a Collection</h2>

<p>To get all documents in a collection, use this method. You can page through results using the start and count URL parameters.</p>
<pre><code class="highlight java"><span class="cm">/**
 * Get a list of documents from a collection
 * Document level security applies
 * @param dbname
 * @param collection
 * @param position
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="n">JsonJavaArray</span> <span class="nf">getDocuments</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">,</span> <span class="n">String</span> <span class="n">collection</span><span class="o">,</span> <span class="kt">int</span> <span class="n">position</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">loadURL</span><span class="o">(</span><span class="s">"/1.0/collections/"</span> <span class="o">+</span> <span class="n">dbname</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">collection</span> <span class="o">+</span> <span class="s">"?start="</span> <span class="o">+</span> <span class="n">position</span><span class="o">);</span>

    <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
    <span class="n">JsonJavaObject</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaObject</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="na">getAsArray</span><span class="o">(</span><span class="s">"data"</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="s1">'https://eu.ldcvia.com'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="s1">'MYSECRETAPIKEY'</span><span class="p">;</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">url</span><span class="p">:</span> <span class="nx">root</span> <span class="o">+</span> <span class="s1">'/1.0/collections/'</span> <span class="o">+</span> <span class="nx">dbname</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nx">collectionname</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"count"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"53c8cf7983217c4dd0a5580b"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Title"</span><span class="p">:</span><span class="s2">"This is the title"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Body"</span><span class="p">:</span><span class="s2">"LDC Via frees your Domino data to be used in other applications or to\r\nallow the sunsetting of your Domino infrastructure without losing the data\r\nand security that you have grown used to.\r\n\r\n(See attached file: API.xlsx)"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Body__parsed"</span><span class="p">:</span><span class="s2">"LDC Via frees your Domino data to be used in other applications or to\r\nallow the sunsetting of your Domino infrastructure without losing the data\r\nand security that you have grown used to.\r\n\r\n(See attached file: API.xlsx)"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"readers"</span><span class="p">:[</span><span class="w"> </span><span class="s2">"CN=Matt White/O=Exhilarate"</span><span class="p">,</span><span class="w"> </span><span class="s2">"CN=Fred Bloggs/O=FCL"</span><span class="w"> </span><span class="p">],</span><span class="w">
      </span><span class="s2">"__unid"</span><span class="p">:</span><span class="s2">"C56DB3F14258431380257D190026303A"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"__noteid"</span><span class="p">:</span><span class="s2">"10F2"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"__created"</span><span class="p">:</span><span class="s2">"2014-07-18T06:57:07Z"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"__modified"</span><span class="p">:</span><span class="s2">"2014-07-18T07:21:31Z"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"__authors"</span><span class="p">:</span><span class="s2">"CN=Matt White/O=Exhilarate"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"__form"</span><span class="p">:</span><span class="s2">"MainTopic"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"_files"</span><span class="p">:[</span><span class="w"> </span><span class="s2">"API.xlsx"</span><span class="w"> </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/collections/:database/:collectionname</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service</td>
</tr>
<tr>
<td>:collectionname</td>
<td>The name of the collection to get documents from</td>
</tr>
</tbody></table>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>count</td>
<td>30</td>
<td>The number of documents to get data for.</td>
</tr>
<tr>
<td>start</td>
<td>0</td>
<td>The starting position in the view, use this to page through documents</td>
</tr>
<tr>
<td>sortasc</td>
<td>null</td>
<td>The name of the field to sort results in ascending order</td>
</tr>
<tr>
<td>sortdesc</td>
<td>__created</td>
<td>The name of the field to sort results in descending order</td>
</tr>
</tbody></table>

<h3 id="response-json">Response JSON</h3>

<table><thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>count</td>
<td>the total count of documents in the collection that the current user can see</td>
</tr>
<tr>
<td>data</td>
<td>an array of document objects. the size of this array will not exceed the count URL parameter even if there are more documents in the collection. You will need to page through the data to get it all.</td>
</tr>
<tr>
<td>_id</td>
<td>internal unique reference id</td>
</tr>
<tr>
<td>rich text fields</td>
<td>when accessed via a collection all formatting is removed and a plain text representation of the content is returned. For full access to the rich text load the relevant document. Rich Text fields always have a second &ldquo;__parsed&rdquo; version of the field that can be used for searching purposes, this allows binary data to be stored in the primary rich text field</td>
</tr>
<tr>
<td>system fields</td>
<td>fields prefixed with __ are system fields that relate to your original Domino data. If the document has file attachments associated with it, the names of the files can be found in the field _files</td>
</tr>
</tbody></table>

<h2 id="delete-entire-collection">Delete entire collection</h2>

<p>To delete a collection, use this method. You must be a super user to perform this operation, or you will receive a 401 error.</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpDelete</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Get a list of databases that the current user has access to
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteCollection</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">,</span> <span class="n">String</span> <span class="n">collection</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">deleteURL</span><span class="o">(</span><span class="s">"/1.0/document/"</span> <span class="o">+</span> <span class="n">dbname</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">collection</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to delete a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">deleteURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpDelete</span> <span class="n">httpdelete</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpDelete</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'DELETE'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span> <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/collections/'</span> <span class="o">+</span> <span class="nx">database</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nx">collection</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">){</span>
    <span class="nx">getDBCollections</span><span class="p">(</span><span class="nx">database</span><span class="p">);</span>
  <span class="p">},</span>
  <span class="nx">error</span><span class="err">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">error</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">401</span><span class="p">){</span>
      <span class="nx">alert</span><span class="p">(</span><span class="s2">"You do not have the rights to delete the collection"</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="nx">alert</span><span class="p">(</span><span class="nx">status</span> <span class="o">+</span> <span class="s1">'\n'</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})</span>

</code></pre>

<blockquote>
<p>The above returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ok"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">DELETE https://eu.ldcvia.com/1.0/collections/:database/:collectionname</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service</td>
</tr>
<tr>
<td>:collectionname</td>
<td>The name of the collection to delete</td>
</tr>
</tbody></table>

<h2 id="search-in-a-collection">Search in a collection</h2>
<pre><code class="highlight plaintext">/*
Example queries
Search for documents where the field Body contains test OR the field From equals fred@ldcvia.com
*/
</code></pre>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"filters"</span><span class="p">:</span><span class="w"> </span><span class="p">[{</span><span class="w">
    </span><span class="s2">"operator"</span><span class="p">:</span><span class="w"> </span><span class="s2">"contains"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Body"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"test"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"operator"</span><span class="p">:</span><span class="w"> </span><span class="s2">"equals"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"From"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fred@ldcvia.com"</span><span class="w">
  </span><span class="p">}]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre><code class="highlight plaintext">/*
Search for documents created on or after 1st Jan 2015 and on or before 31st Jan 2015 (remember to set ...&amp;join=and on the URL)
*/
</code></pre>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"filters"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"operator"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$gte"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"__created"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-01-01T00:00:00"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"operator"</span><span class="p">:</span><span class="w"> </span><span class="s2">"$lte"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"field"</span><span class="p">:</span><span class="w"> </span><span class="s2">"__created"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"value"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-01-31T23:59:59"</span><span class="w">
  </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
<pre><code class="highlight plaintext">/*
Perform a full text search for the words "some text"
*/
</code></pre>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"fulltext"</span><span class="p">:</span><span class="w"> </span><span class="s2">"some text"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<p>To perform a search against a collection, you can submit queries to be run against one or more fields or against the entire collection using full text.</p>

<p>To use a full text query, the database must be indexed which can be enabled in DB Viewer - Database Settings. Full Text Indexes can only be enabled for paid accounts.</p>

<p>Search queries are built up using an array of JSON objects. You can search for exact matches in a field, fields that contain text, or date and number ranges. You can add as many parameters to a search as are required to get the set of documents that you need, and then use the URL parameters count and start to page through the results. In this way you can effectively create the equivalent of Notes views of data.</p>

<p>Full Text and field based queries can be mixed together in the same request if required.</p>

<p>Keywords that you can use to search for data include:</p>

<table><thead>
<tr>
<th>Operator</th>
<th>Function</th>
</tr>
</thead><tbody>
<tr>
<td>contains</td>
<td>used to search a field to see if it contains the value being searched for</td>
</tr>
<tr>
<td>equals</td>
<td>used to find a field that is an exact match for the value being searched for</td>
</tr>
<tr>
<td>$gte</td>
<td>used when searching for dates and numbers greater than or equal to the value entered. For dates the full <a href="http://en.wikipedia.org/wiki/ISO_8601">ISO 8601 format</a> should be used</td>
</tr>
<tr>
<td>$lte</td>
<td>used when searching for dates and numbers less than or equal to the value entered. For dates the full <a href="http://en.wikipedia.org/wiki/ISO_8601">ISO 8601 format</a> should be used</td>
</tr>
</tbody></table>

<p>Examples of different search JSON objects can be seen to the right of this page.</p>

<p>When you enter multiple criteria, they are applied together with an OR style join by default, change this to AND using the URL parameter &ldquo;&hellip;&amp;join=and&rdquo;.</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpPost</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.entity.StringEntity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Search against a field
 *  
 * @param dbname
 * @param collection
 * @param fieldname
 * @param query
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="n">JsonJavaArray</span> <span class="nf">searchField</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">,</span> <span class="n">String</span> <span class="n">collection</span><span class="o">,</span> <span class="n">String</span> <span class="n">fieldname</span><span class="o">,</span> <span class="n">String</span> <span class="n">query</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">postURL</span><span class="o">(</span><span class="s">"/1.0/search/"</span> <span class="o">+</span> <span class="n">dbname</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">collection</span><span class="o">,</span> <span class="s">"{\"filters\": [{\"operator\": \"contains\", \"field\": \""</span> <span class="o">+</span> <span class="n">fieldname</span> <span class="o">+</span> <span class="s">"\", \"value\": \""</span> <span class="o">+</span> <span class="n">query</span> <span class="o">+</span> <span class="s">"\"}]}"</span><span class="o">);</span>
    <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
    <span class="n">JsonJavaObject</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaObject</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="na">getAsArray</span><span class="o">(</span><span class="s">"data"</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to post data to a URL from the LDC Via service
 * @param url
 * @param data
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">postURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">data</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpPost</span> <span class="n">httppost</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpPost</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>
  <span class="n">StringEntity</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringEntity</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
    <span class="n">input</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">);</span>
    <span class="n">httppost</span><span class="o">.</span><span class="na">setEntity</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
  <span class="n">httppost</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httppost</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">data</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">"filters"</span><span class="p">:</span> <span class="p">[{</span>
      <span class="s2">"operator"</span><span class="p">:</span> <span class="s2">"contains"</span><span class="p">,</span>
      <span class="s2">"field"</span><span class="p">:</span> <span class="s2">"FieldToSearch"</span><span class="p">,</span>
      <span class="s2">"value"</span><span class="p">:</span> <span class="nx">query</span>
    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">"operator"</span><span class="p">:</span> <span class="s2">"equals"</span><span class="p">,</span>
      <span class="s2">"field"</span><span class="p">:</span> <span class="s2">"From"</span><span class="p">,</span>
      <span class="s2">"value"</span><span class="p">:</span> <span class="nx">query</span>
    <span class="p">}]</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/search/'</span> <span class="o">+</span> <span class="nx">dbname</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">collectionname</span> <span class="o">+</span> <span class="s2">"?count=10&amp;start="</span> <span class="o">+</span> <span class="nx">start</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"count"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"53c8cf7983217c4dd0a5580b"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Title"</span><span class="p">:</span><span class="s2">"This is the title"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"Body"</span><span class="p">:</span><span class="s2">"NSF2MongoDB frees your Domino data to be used in other applications or to\r\nallow the sunsetting of your Domino infrastructure without losing the data\r\nand security that you have grown used to.\r\n\r\n(See attached file: API.xlsx)"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"readers"</span><span class="p">:[</span><span class="w">
        </span><span class="s2">"CN=Matt White/O=Exhilarate"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"CN=Fred Bloggs/O=FCL"</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="s2">"__unid"</span><span class="p">:</span><span class="s2">"C56DB3F14258431380257D190026303A"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"__noteid"</span><span class="p">:</span><span class="s2">"10F2"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"__created"</span><span class="p">:</span><span class="s2">"2014-07-18T06:57:07Z"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"__modified"</span><span class="p">:</span><span class="s2">"2014-07-18T07:21:31Z"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"__authors"</span><span class="p">:</span><span class="s2">"CN=Matt White/O=Exhilarate"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"__form"</span><span class="p">:</span><span class="s2">"MainTopic"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"_files"</span><span class="p">:[</span><span class="w">
        </span><span class="s2">"API.xlsx"</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">POST https://eu.ldcvia.com/1.0/search/:database/:collectionname</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service</td>
</tr>
<tr>
<td>:collectionname</td>
<td>The name of the collection to search in</td>
</tr>
</tbody></table>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>count</td>
<td>30</td>
<td>The number of documents to get data for.</td>
</tr>
<tr>
<td>start</td>
<td>0</td>
<td>The starting position in the view, use this to page through documents</td>
</tr>
<tr>
<td>join</td>
<td>or</td>
<td>If you are applying multiple queries in a single search, the default will be to join them with an OR operator. Use this parameter to change the join to AND by setting &amp;join=and in the URL</td>
</tr>
<tr>
<td>sortasc</td>
<td>null</td>
<td>The name of the field to sort results in ascending order</td>
</tr>
<tr>
<td>sortdesc</td>
<td>__created</td>
<td>The name of the field to sort results in descending order</td>
</tr>
</tbody></table>

<h3 id="response-json">Response JSON</h3>

<table><thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>count</td>
<td>the total count of documents in the collection that the current user can see and that match the search criteria</td>
</tr>
<tr>
<td>data</td>
<td>an array of document objects. the size of this array will not exceed the count URL parameter even if there are more documents in the collection. You will need to page through the data to get it all.</td>
</tr>
<tr>
<td>_id</td>
<td>internal unique reference id</td>
</tr>
<tr>
<td>rich text fields</td>
<td>when accessed via a collection all formatting is removed and a plain text representation of the content is returned. For full access to the rich text load the relevant document. Rich Text fields always have a second &ldquo;__parsed&rdquo; version of the field that can be used for searching purposes, this allows binary data to be stored in the primary rich text field</td>
</tr>
<tr>
<td>system fields</td>
<td>fields prefixed with __ are system fields that relate to your original Domino data. If the document has file attachments associated with it, the names of the files can be found in the field _files</td>
</tr>
</tbody></table>

<h1 id="views">Views</h1>

<p>A view is a saved filter that can be used to provide a quick way of accessing a subset of data. Think of it as a saved search. The query property of a view can be used to search in a collection</p>

<h2 id="get-all-views-in-a-database">Get all views in a database</h2>

<p>Given a database name, this method will return a list of all views in the database.</p>
<pre><code class="highlight java"><span class="cm">/**
 * Gets a list of views for the given database
 *
 * @param dbname
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">ArrayList</span> <span class="nf">getViews</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">loadURL</span><span class="o">(</span><span class="s">"/1.0/views/"</span> <span class="o">+</span> <span class="n">dbname</span><span class="o">);</span>

    <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
    <span class="n">ArrayList</span> <span class="n">list</span> <span class="o">=</span> <span class="o">(</span><span class="n">ArrayList</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>
    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="k">new</span> <span class="n">CollectionComparator</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to request a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">loadURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpGet</span> <span class="n">httpget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="s1">'https://eu.ldcvia.com'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="s1">'MYSECRETAPIKEY'</span><span class="p">;</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">url</span><span class="p">:</span> <span class="nx">root</span> <span class="o">+</span> <span class="s1">'/1.0/views/'</span> <span class="o">+</span> <span class="nx">dbname</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"query"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"{\"filters\":[{\"operator\":\"contains\",\"field\":\"Categories\",\"value\":\"API\"}]}"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"API Documents"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"collname"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MainTopic"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"API-Documents"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"dbname"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"dev-londc-com-demos-discussion-nsf"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"createdAt"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-06-03T10:34:46.037Z"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"style"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"or"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"__v"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/views/:database</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service</td>
</tr>
</tbody></table>

<h2 id="get-a-view-in-a-database">Get a view in a database</h2>

<p>Given a database name and a view, this method will return the details of the view.</p>
<pre><code class="highlight java"><span class="cm">/**
 * Gets a view for the given database
 *
 * @param dbname
 * @param viewname
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="nd">@SuppressWarnings</span><span class="o">(</span><span class="s">"unchecked"</span><span class="o">)</span>
<span class="kd">public</span> <span class="n">ArrayList</span> <span class="nf">getViews</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">,</span> <span class="n">String</span> <span class="n">viewname</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">loadURL</span><span class="o">(</span><span class="s">"/1.0/views/"</span> <span class="o">+</span> <span class="n">dbname</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">viewname</span><span class="o">);</span>

    <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
    <span class="n">ArrayList</span> <span class="n">list</span> <span class="o">=</span> <span class="o">(</span><span class="n">ArrayList</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>
    <span class="n">Collections</span><span class="o">.</span><span class="na">sort</span><span class="o">(</span><span class="n">list</span><span class="o">,</span> <span class="k">new</span> <span class="n">CollectionComparator</span><span class="o">());</span>
    <span class="k">return</span> <span class="n">list</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to request a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">loadURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpGet</span> <span class="n">httpget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="s1">'https://eu.ldcvia.com'</span><span class="p">;</span>
<span class="kd">var</span> <span class="nx">apikey</span> <span class="o">=</span> <span class="s1">'MYSECRETAPIKEY'</span><span class="p">;</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">url</span><span class="p">:</span> <span class="nx">root</span> <span class="o">+</span> <span class="s1">'/1.0/views/'</span> <span class="o">+</span> <span class="nx">dbname</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nx">viewname</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">res</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above command returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"query"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"{\"filters\":[{\"operator\":\"contains\",\"field\":\"Categories\",\"value\":\"API\"}]}"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"title"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"API Documents"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"collname"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"MainTopic"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"name"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"API-Documents"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"dbname"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"dev-londc-com-demos-discussion-nsf"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"createdAt"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-06-03T10:34:46.037Z"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"style"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="s2">"or"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"__v"</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/views/:database/:view</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service</td>
</tr>
<tr>
<td>:view</td>
<td>This is the unique name of the view to read configuration from</td>
</tr>
</tbody></table>

<h2 id="add-or-update-a-view">Add or update a view</h2>

<p>Store the configuration of a view</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpPut</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.entity.StringEntity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="cm">/**
 * Create a new view
 *  
 * @param dbname
 * @param collection
 * @param viewname
 * @param title
 * @param style
 * @param query
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">createNewDocument</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">,</span> <span class="n">String</span> <span class="n">collection</span><span class="o">,</span> <span class="n">String</span> <span class="n">viewname</span><span class="o">,</span> <span class="n">String</span> <span class="n">title</span><span class="o">,</span> <span class="n">String</span> <span class="n">style</span><span class="o">,</span> <span class="n">String</span> <span class="n">query</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
  <span class="n">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">();</span>
    <span class="n">putURL</span><span class="o">(</span><span class="s">"/1.0/views/"</span> <span class="o">+</span> <span class="n">dbname</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">viewname</span> <span class="s">"{\"title\": \""</span> <span class="o">+</span> <span class="n">title</span> <span class="o">+</span> <span class="s">"\", \"style\": \""</span> <span class="o">+</span> <span class="n">style</span> <span class="o">+</span> <span class="s">"\", \"query\": \""</span> <span class="o">+</span> <span class="n">query</span> <span class="o">+</span> <span class="s">"\"}"</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to post data to a URL from the LDC Via service
 * @param url
 * @param data
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">putURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">data</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpPut</span> <span class="n">httpput</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpPust</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>
  <span class="n">StringEntity</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringEntity</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
    <span class="n">input</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">);</span>
    <span class="n">httppost</span><span class="o">.</span><span class="na">setEntity</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
  <span class="n">httppost</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httppost</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="kd">var</span> <span class="nx">saveNewView</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="c1">//Start building the document data</span>
  <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">collname</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#collname"</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">title</span> <span class="o">=</span> <span class="nx">viewtitle</span><span class="p">;</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">style</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#querystyle"</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
  <span class="kd">var</span> <span class="nx">query</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"filters"</span><span class="p">:</span> <span class="p">[]};</span>

  <span class="kd">var</span> <span class="nx">rows</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#viewtable tbody tr"</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span><span class="o">&lt;</span><span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">fieldname</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#viewtable_fieldname_"</span> <span class="o">+</span> <span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)).</span><span class="nx">val</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">comparetype</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#viewtable_comparetype_"</span> <span class="o">+</span> <span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)).</span><span class="nx">val</span><span class="p">();</span>
    <span class="kd">var</span> <span class="nx">comparevalue</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#viewtable_comparevalue_"</span> <span class="o">+</span> <span class="p">(</span><span class="nx">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)).</span><span class="nx">val</span><span class="p">();</span>
    <span class="nx">query</span><span class="p">.</span><span class="nx">filters</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span><span class="s1">'operator'</span><span class="p">:</span> <span class="nx">comparetype</span><span class="p">,</span> <span class="s1">'field'</span><span class="p">:</span> <span class="nx">fieldname</span><span class="p">,</span> <span class="s1">'value'</span><span class="p">:</span> <span class="nx">comparevalue</span><span class="p">});</span>
  <span class="p">}</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">query</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">query</span><span class="p">);</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
    <span class="na">type</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
      <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
    <span class="p">},</span>
    <span class="na">data</span><span class="p">:</span> <span class="nx">data</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/views/'</span> <span class="o">+</span> <span class="nx">dbname</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">viewname</span><span class="p">,</span>
    <span class="na">complete</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">//Do something</span>
    <span class="p">}</span>
  <span class="p">});</span>

<span class="p">}</span>
</code></pre>

<blockquote>
<p>If the view is inserted correctly, the above returns a 200 success code, otherwise you will receive an error</p>
</blockquote>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">POST https://eu.ldcvia.com/1.0/views/:database/:viewname</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service</td>
</tr>
<tr>
<td>:viewname</td>
<td>The name of the view to store</td>
</tr>
</tbody></table>

<h2 id="delete-a-view">Delete a view</h2>

<p>To delete a view, use this method.</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpDelete</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Delete a view from a database
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteDocument</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">,</span> <span class="n">String</span> <span class="n">viewname</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">deleteURL</span><span class="o">(</span><span class="s">"/1.0/document/"</span> <span class="o">+</span> <span class="n">dbname</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">viewname</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to delete a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">deleteURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpDelete</span> <span class="n">httpdelete</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpDelete</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'DELETE'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span> <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/document/'</span> <span class="o">+</span> <span class="nx">database</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nx">viewname</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">){</span>
    <span class="c1">//Do something</span>
  <span class="p">},</span>
  <span class="nx">error</span><span class="err">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">error</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">401</span><span class="p">){</span>
      <span class="nx">alert</span><span class="p">(</span><span class="s2">"You do not have the rights to delete the view"</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="nx">alert</span><span class="p">(</span><span class="nx">status</span> <span class="o">+</span> <span class="s1">'\n'</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})</span>

</code></pre>

<blockquote>
<p>The above returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="err">'ok'</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">DELETE https://eu.ldcvia.com/1.0/views/:database/:viewname</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service</td>
</tr>
<tr>
<td>:viewname</td>
<td>The name of the view to delete</td>
</tr>
</tbody></table>

<h1 id="documents">Documents</h1>

<p>A document is a group of fields that are related to each other. Not all documents the same, but it is a fair assumption that all documents in the same collection will have the same group of fields on them.</p>

<h2 id="get-a-document">Get a document</h2>

<p>To get the full detail for a document, use this method.</p>
<pre><code class="highlight java"><span class="cm">/**
 * Get full detail for an individual document
 * @param dbname
 * @param collection
 * @param unid
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="n">JsonJavaObject</span> <span class="nf">getDocument</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">,</span> <span class="n">String</span> <span class="n">collection</span><span class="o">,</span> <span class="n">String</span> <span class="n">unid</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span> <span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">loadURL</span><span class="o">(</span><span class="s">"/1.0/document/"</span> <span class="o">+</span> <span class="n">dbname</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">collection</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">unid</span><span class="o">);</span>

    <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
    <span class="n">JsonJavaObject</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaObject</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">;</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/document/'</span> <span class="o">+</span> <span class="nx">dbname</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">collectionname</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">unid</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"53c8cf7783217c4dd0a557f6"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"Formname"</span><span class="p">:</span><span class="s2">"Response"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ThreadSort"</span><span class="p">:</span><span class="s2">" 201218/062011:17:20 771AB2C8B80E229980257A210038850A"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ThreadIndent"</span><span class="p">:</span><span class="s2">". . "</span><span class="p">,</span><span class="w">
  </span><span class="s2">"From"</span><span class="p">:</span><span class="s2">"CN=Matt White/O=Exhilarate"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ParentForm"</span><span class="p">:</span><span class="s2">"Response"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"ParentSubject"</span><span class="p">:</span><span class="s2">"Response"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"Categories"</span><span class="p">:</span><span class="s2">"Sales"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"Body"</span><span class="p">:{</span><span class="w">
    </span><span class="s2">"type"</span><span class="p">:</span><span class="s2">"multipart"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"content"</span><span class="p">:[</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"contentType"</span><span class="p">:</span><span class="s2">"multipart/alternative; Boundary=\"0__=0FBBF78ADFB9AAF98f9e8a93df938690918c0FBBF78ADFB9AAF9\""</span><span class="p">,</span><span class="w">
</span><span class="s2">"contentDisposition"</span><span class="p">:</span><span class="s2">"inline"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"contentType"</span><span class="p">:</span><span class="s2">"text/plain; charset=US-ASCII"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"data"</span><span class="p">:</span><span class="s2">"This looks good to me - we need to make sure that the right Project Manager\r\nis assigned to this project"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"boundary"</span><span class="p">:</span><span class="s2">"--0__=0FBBF78ADFB9AAF98f9e8a93df938690918c0FBBF78ADFB9AAF9"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
        </span><span class="s2">"contentType"</span><span class="p">:</span><span class="s2">"text/html; charset=US-ASCII"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"contentDisposition"</span><span class="p">:</span><span class="s2">"inline"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"data"</span><span class="p">:</span><span class="s2">"&lt;html&gt;&lt;body&gt;&lt;font size=\"1\" face=\"sans-serif\"&gt;This looks good to me - we need to make sure that the right Project Manager is assigned to this project &lt;/font&gt;&lt;/body&gt;&lt;/html&gt;"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"boundary"</span><span class="p">:</span><span class="s2">"--0__=0FBBF78ADFB9AAF98f9e8a93df938690918c0FBBF78ADFB9AAF9"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"Body__parsed"</span><span class="p">:</span><span class="s2">"&lt;html&gt;&lt;body&gt;&lt;font size=\"1\" face=\"sans-serif\"&gt;This looks good to me - we need to make sure that the right Project Manager is assigned to this project &lt;/font&gt;&lt;/body&gt;&lt;/html&gt;"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"Subject"</span><span class="p">:</span><span class="s2">"Looks good to me"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"__href"</span><span class="p">:</span><span class="s2">"http://dev.londc.com:80/demos/Discussion.nsf/api/data/documents/unid/FC7D00934676A6B580257D1900278BAA"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"__unid"</span><span class="p">:</span><span class="s2">"FC7D00934676A6B580257D1900278BAA"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"__noteid"</span><span class="p">:</span><span class="s2">"114E"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"__parentid"</span><span class="p">:</span><span class="s2">"E2445C89357BB15080257D1900278BA9"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"__created"</span><span class="p">:</span><span class="s2">"2014-07-18T07:11:56Z"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"__modified"</span><span class="p">:</span><span class="s2">"2014-07-18T07:13:19Z"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"__authors"</span><span class="p">:</span><span class="w">  </span><span class="p">[</span><span class="w"> </span><span class="s2">"CN=Matt White/O=Exhilarate"</span><span class="p">,</span><span class="w"> </span><span class="s2">"CN=Matt White/O=Exhilarate"</span><span class="w"> </span><span class="p">],</span><span class="w">
  </span><span class="s2">"__form"</span><span class="p">:</span><span class="s2">"Response"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"_files"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w"> </span><span class="s2">"api.xls"</span><span class="w"> </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/document/:database/:collectionname/:unid</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service.</td>
</tr>
<tr>
<td>:collectionname</td>
<td>The name of the collection that contains the document</td>
</tr>
<tr>
<td>:unid</td>
<td>The unique ID of the document to get (this maps to the __unid field, not the _id field)</td>
</tr>
</tbody></table>

<h2 id="insert-a-new-document">Insert a new document</h2>

<p>To insert a new document, use the PUT method and send JSON data to the service. If a document with the :unid already exists in the collection, an error will be returned. Use the POST method to update existing documents.</p>

<p>If the collection name (or database name) do not currently exist then they will automatically be created. By this process you can effectively create a brand new database by simply inserting a new document. Bear in mind that you will need to set up security for the database once it has been created.</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpPut</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.entity.StringEntity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Date</span><span class="o">;</span>

<span class="cm">/**
 * Create a new document
 *  
 * @param dbname
 * @param collection
 * @param subject
 * @param body
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">createNewDocument</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">,</span> <span class="n">String</span> <span class="n">collection</span><span class="o">,</span> <span class="n">String</span> <span class="n">subject</span><span class="o">,</span> <span class="n">String</span> <span class="n">body</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
  <span class="n">Date</span> <span class="n">date</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Date</span><span class="o">();</span>
    <span class="n">putURL</span><span class="o">(</span><span class="s">"/1.0/document/"</span> <span class="o">+</span> <span class="n">dbname</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">collection</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">date</span><span class="o">.</span><span class="na">getTime</span><span class="o">(),</span> <span class="s">"{\"subject\": "</span> <span class="o">+</span> <span class="n">subject</span> <span class="o">+</span> <span class="s">", \"body\": "</span> <span class="o">+</span> <span class="n">body</span> <span class="o">+</span> <span class="s">"}"</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to post data to a URL from the LDC Via service
 * @param url
 * @param data
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">putURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">data</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpPut</span> <span class="n">httpput</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpPust</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>
  <span class="n">StringEntity</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringEntity</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
    <span class="n">input</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">);</span>
    <span class="n">httppost</span><span class="o">.</span><span class="na">setEntity</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
  <span class="n">httppost</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httppost</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="c1">//Taken from our Discussion template</span>
<span class="nx">disc</span><span class="p">.</span><span class="nx">saveNewMainTopic</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">fileInput</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#fileupload"</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">file</span> <span class="o">=</span> <span class="nx">fileInput</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileReader</span><span class="p">();</span>
  <span class="c1">//Start building the document data</span>
  <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">FormName</span> <span class="o">=</span> <span class="s2">"MainTopic"</span><span class="p">;</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">__form</span> <span class="o">=</span> <span class="s2">"MainTopic"</span><span class="p">;</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">Categories</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#categories option:selected"</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">From</span> <span class="o">=</span> <span class="nx">username</span><span class="p">;</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">AbbreviateFrom</span> <span class="o">=</span> <span class="nx">username</span><span class="p">;</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">Body</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"multipart"</span><span class="p">,</span>
    <span class="s2">"content"</span><span class="p">:</span> <span class="p">[{</span>
      <span class="s2">"contentType"</span><span class="p">:</span> <span class="s2">"text/plain; charset=UTF-8"</span><span class="p">,</span>
      <span class="s2">"data"</span><span class="p">:</span> <span class="nx">CKEDITOR</span><span class="p">.</span><span class="nx">instances</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">getData</span><span class="p">()</span>
    <span class="p">}]</span>
  <span class="p">};</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">Subject</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#subject"</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">__created</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">();</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">__modified</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">toISOString</span><span class="p">();</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Convert the file attachment to BASE64 string</span>
    <span class="nx">reader</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">data</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="s2">"contentType"</span><span class="p">:</span> <span class="nx">file</span><span class="p">.</span><span class="nx">type</span> <span class="o">+</span> <span class="s2">"; name=\""</span> <span class="o">+</span> <span class="nx">file</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">"\""</span><span class="p">,</span>
        <span class="s2">"contentDisposition"</span><span class="p">:</span> <span class="s2">"attachment; filename=\""</span> <span class="o">+</span> <span class="nx">file</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">"\""</span><span class="p">,</span>
        <span class="s2">"contentTransferEncoding"</span><span class="p">:</span> <span class="s2">"base64"</span><span class="p">,</span>
        <span class="s2">"data"</span><span class="p">:</span> <span class="nx">reader</span><span class="p">.</span><span class="nx">result</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/,</span><span class="se">(</span><span class="sr">.*</span><span class="se">)</span><span class="sr">$/</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
      <span class="p">});</span>
      <span class="nx">disc</span><span class="p">.</span><span class="nx">sendNewMainTopic</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">reader</span><span class="p">.</span><span class="nx">readAsDataURL</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">disc</span><span class="p">.</span><span class="nx">sendNewMainTopic</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">disc</span><span class="p">.</span><span class="nx">sendNewMainTopic</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">data</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">unid</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
    <span class="na">type</span><span class="p">:</span> <span class="s1">'PUT'</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
      <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
    <span class="p">},</span>
    <span class="na">data</span><span class="p">:</span> <span class="nx">data</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/document/'</span> <span class="o">+</span> <span class="nx">dbname</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">FormName</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">unid</span><span class="p">,</span>
    <span class="na">complete</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">//Do something</span>
    <span class="p">}</span>
  <span class="p">});</span>

<span class="p">}</span>
</code></pre>

<blockquote>
<p>If the document is inserted correctly, the above returns a 200 success code, otherwise you will receive an error</p>
</blockquote>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">PUT https://eu.ldcvia.com/1.0/document/:database/:collectionname/:unid</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service.</td>
</tr>
<tr>
<td>:collectionname</td>
<td>The name of the collection into which the document will be inserted</td>
</tr>
<tr>
<td>:unid</td>
<td>The unique identifier of the document to be inserted</td>
</tr>
</tbody></table>

<h2 id="update-an-existing-document">Update an existing document</h2>

<p>When you want to update a document use this method. You only need to post the fields that you want to update. Those fields will overwrite matching fields in the document, or add them if they don&rsquo;t already exist. To remove a field set its value to null.</p>

<p>If the document does not exist then an error will be returned, in this case you should use the PUT method instead.</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpPost</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.entity.StringEntity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Update a document
 *
 * @param dbname
 * @param collection
 * @param unid
 * @param subject
 * @param body
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateDocument</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">,</span> <span class="n">String</span> <span class="n">collection</span><span class="o">,</span> <span class="n">String</span> <span class="n">unid</span><span class="o">,</span> <span class="n">String</span> <span class="n">subject</span><span class="o">,</span> <span class="n">String</span> <span class="n">body</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">postURL</span><span class="o">(</span><span class="s">"/1.0/document/"</span> <span class="o">+</span> <span class="n">dbname</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">collection</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">unid</span><span class="o">,</span> <span class="s">"{\"subject\": "</span> <span class="o">+</span> <span class="n">subject</span> <span class="o">+</span> <span class="s">", \"body\": "</span> <span class="o">+</span> <span class="n">body</span> <span class="o">+</span> <span class="s">"}"</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to post data to a URL from the LDC Via service
 * @param url
 * @param data
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">postURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">data</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpPut</span> <span class="n">httppost</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpPost</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>
  <span class="n">StringEntity</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringEntity</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
    <span class="n">input</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">);</span>
    <span class="n">httppost</span><span class="o">.</span><span class="na">setEntity</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
  <span class="n">httppost</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httppost</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="c1">//Taken from our Discussion template</span>
<span class="nx">disc</span><span class="p">.</span><span class="nx">saveMainTopic</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">unid</span><span class="p">)</span> <span class="p">{</span>
  <span class="kd">var</span> <span class="nx">fileInput</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#fileupload"</span><span class="p">);</span>
  <span class="kd">var</span> <span class="nx">file</span> <span class="o">=</span> <span class="nx">fileInput</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
  <span class="kd">var</span> <span class="nx">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileReader</span><span class="p">();</span>
  <span class="c1">//Start building the document data</span>
  <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{};</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">FormName</span> <span class="o">=</span> <span class="s2">"MainTopic"</span><span class="p">;</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">__form</span> <span class="o">=</span> <span class="s2">"MainTopic"</span><span class="p">;</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">Categories</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#categories option:selected"</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">From</span> <span class="o">=</span> <span class="nx">username</span><span class="p">;</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">AbbreviateFrom</span> <span class="o">=</span> <span class="nx">username</span><span class="p">;</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">Body</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">"type"</span><span class="p">:</span> <span class="s2">"multipart"</span><span class="p">,</span>
    <span class="s2">"content"</span><span class="p">:</span> <span class="p">[{</span>
      <span class="s2">"contentType"</span><span class="p">:</span> <span class="s2">"text/plain; charset=UTF-8"</span><span class="p">,</span>
      <span class="s2">"data"</span><span class="p">:</span> <span class="nx">CKEDITOR</span><span class="p">.</span><span class="nx">instances</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">getData</span><span class="p">()</span>
    <span class="p">}]</span>
  <span class="p">};</span>
  <span class="nx">data</span><span class="p">.</span><span class="nx">Subject</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">"#subject"</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>

  <span class="k">if</span> <span class="p">(</span><span class="nx">file</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Convert the file attachment to BASE64 string</span>
    <span class="nx">reader</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">data</span><span class="p">.</span><span class="nx">Body</span><span class="p">.</span><span class="nx">content</span><span class="p">.</span><span class="nx">push</span><span class="p">({</span>
        <span class="s2">"contentType"</span><span class="p">:</span> <span class="nx">file</span><span class="p">.</span><span class="nx">type</span> <span class="o">+</span> <span class="s2">"; name=\""</span> <span class="o">+</span> <span class="nx">file</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">"\""</span><span class="p">,</span>
        <span class="s2">"contentDisposition"</span><span class="p">:</span> <span class="s2">"attachment; filename=\""</span> <span class="o">+</span> <span class="nx">file</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="s2">"\""</span><span class="p">,</span>
        <span class="s2">"contentTransferEncoding"</span><span class="p">:</span> <span class="s2">"base64"</span><span class="p">,</span>
        <span class="s2">"data"</span><span class="p">:</span> <span class="nx">reader</span><span class="p">.</span><span class="nx">result</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="sr">/,</span><span class="se">(</span><span class="sr">.*</span><span class="se">)</span><span class="sr">$/</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
      <span class="p">});</span>
      <span class="nx">disc</span><span class="p">.</span><span class="nx">sendNewMainTopic</span><span class="p">(</span><span class="nx">unid</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="nx">reader</span><span class="p">.</span><span class="nx">readAsDataURL</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">disc</span><span class="p">.</span><span class="nx">sendMainTopic</span><span class="p">(</span><span class="nx">unid</span><span class="p">,</span> <span class="nx">data</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
<span class="nx">disc</span><span class="p">.</span><span class="nx">sendMainTopic</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">unid</span><span class="p">,</span> <span class="nx">data</span><span class="p">)</span> <span class="p">{</span>

  <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
    <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
    <span class="na">type</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
    <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
      <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
    <span class="p">},</span>
    <span class="na">data</span><span class="p">:</span> <span class="nx">data</span><span class="p">,</span>
    <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/document/'</span> <span class="o">+</span> <span class="nx">dbname</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">data</span><span class="p">.</span><span class="nx">FormName</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">unid</span><span class="p">,</span>
    <span class="na">complete</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">//Do something</span>
    <span class="p">}</span>
  <span class="p">});</span>

<span class="p">}</span>
</code></pre>

<blockquote>
<p>If the document is updated correctly, the above returns a 200 success code, otherwise you will receive an error</p>
</blockquote>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">POST https://eu.ldcvia.com/1.0/document/:database/:collectionname/:unid</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service.</td>
</tr>
<tr>
<td>:collectionname</td>
<td>The name of the collection in which the document will be updated</td>
</tr>
<tr>
<td>:unid</td>
<td>The unique identifier of the document to be updated</td>
</tr>
</tbody></table>

<h2 id="delete-a-document">Delete a document</h2>

<p>To delete a document, use this method. You must have the rights to update the document</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpDelete</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Get a list of databases that the current user has access to
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteDocument</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">,</span> <span class="n">String</span> <span class="n">collection</span><span class="o">,</span> <span class="n">String</span> <span class="n">unid</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">deleteURL</span><span class="o">(</span><span class="s">"/1.0/document/"</span> <span class="o">+</span> <span class="n">dbname</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">collection</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">unid</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to delete a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">deleteURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpDelete</span> <span class="n">httpdelete</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpDelete</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'DELETE'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span> <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/document/'</span> <span class="o">+</span> <span class="nx">database</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nx">collection</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">unid</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">){</span>
    <span class="c1">//Do something</span>
  <span class="p">},</span>
  <span class="nx">error</span><span class="err">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">error</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">401</span><span class="p">){</span>
      <span class="nx">alert</span><span class="p">(</span><span class="s2">"You do not have the rights to delete the document"</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="nx">alert</span><span class="p">(</span><span class="nx">status</span> <span class="o">+</span> <span class="s1">'\n'</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})</span>

</code></pre>

<blockquote>
<p>The above returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ok"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">DELETE https://eu.ldcvia.com/1.0/document/:database/:collectionname/:unid</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service</td>
</tr>
<tr>
<td>:collectionname</td>
<td>The name of the collection to delete</td>
</tr>
<tr>
<td>:unid</td>
<td>The unid of the document to delete</td>
</tr>
</tbody></table>

<h2 id="reserved-field-names">Reserved Field Names</h2>

<p>We do have several reserved field names in LDC Via that you should avoid modifying (your changes will be ignored), though the fields can be useful when reading data (__unid in particular):</p>

<ul>
<li>__heirarchy</li>
<li>__unid</li>
<li>__form</li>
<li>__created</li>
<li>__modified</li>
<li>_files</li>
<li>fieldnames appended with the value &rsquo;__parsed&rsquo;</li>
<li>__role</li>
<li>__readerrole</li>
<li>__authorrole</li>
<li>__deleted</li>
<li>_id</li>
</ul>

<p>The field _<em>parentid is a field with a specific meaning. If it exists on a document then it makes that document a response to another document within the same database. The only valid value for this field is the _</em>unid of the immediate parent of this document.</p>

<h1 id="file-attachments">File Attachments</h1>

<p>Given a database name, collection name, document id and attachment name, you can either download the attachment or delete it from the database. To insert new attachments, use the document PUT or POST methods.</p>

<h2 id="get-a-file-attachment">Get a File Attachment</h2>
<pre><code class="highlight java"><span class="c1">//TODO: We need sample code here</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nb">window</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">"https://eu.ldcvia.com/1.0/attachment/:database/:collectionname/:unid/:filename"</span><span class="p">);</span>
</code></pre>

<blockquote>
<p>If the file exists (and you are allowed to access it), then the file will be sent as a binary stream to the requestor. If the file does not exists (or you are not allowed to access it) then an error will be returned.</p>
</blockquote>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/attachment/:database/:collectionname/:unid/:filename</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service</td>
</tr>
<tr>
<td>:collectionname</td>
<td>The name of the collection to delete</td>
</tr>
<tr>
<td>:unid</td>
<td>The unid of the document to delete</td>
</tr>
<tr>
<td>:filename</td>
<td>The name of the file to access (can be retrieved from _files field on any document)</td>
</tr>
</tbody></table>

<h2 id="delete-a-file-attachment">Delete a file attachment</h2>

<p>To delete a file attachment, use this method. You must have the rights to update the document to which the file is associated</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpDelete</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Get a list of databases that the current user has access to
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteAttachment</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">,</span> <span class="n">String</span> <span class="n">collection</span><span class="o">,</span> <span class="n">String</span> <span class="n">unid</span><span class="o">,</span> <span class="n">String</span> <span class="n">filename</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">deleteURL</span><span class="o">(</span><span class="s">"/1.0/document/"</span> <span class="o">+</span> <span class="n">dbname</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">collection</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">unid</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">filename</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to delete a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">deleteURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpDelete</span> <span class="n">httpdelete</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpDelete</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'DELETE'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span> <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span> <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/collections/'</span> <span class="o">+</span> <span class="nx">database</span> <span class="o">+</span> <span class="s1">'/'</span> <span class="o">+</span> <span class="nx">collection</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">unid</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">filename</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">){</span>
    <span class="c1">//Do something</span>
  <span class="p">},</span>
  <span class="nx">error</span><span class="err">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">xhr</span><span class="p">,</span> <span class="nx">status</span><span class="p">,</span> <span class="nx">error</span><span class="p">){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">401</span><span class="p">){</span>
      <span class="nx">alert</span><span class="p">(</span><span class="s2">"You do not have the rights to delete the filename"</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="nx">alert</span><span class="p">(</span><span class="nx">status</span> <span class="o">+</span> <span class="s1">'\n'</span> <span class="o">+</span> <span class="nx">error</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">})</span>

</code></pre>

<blockquote>
<p>The above returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ok"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">DELETE https://eu.ldcvia.com/1.0/attachment/:database/:collectionname/:unid/:filename</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service</td>
</tr>
<tr>
<td>:collectionname</td>
<td>The name of the collection to delete</td>
</tr>
<tr>
<td>:unid</td>
<td>The unid of the document to delete</td>
</tr>
<tr>
<td>:filename</td>
<td>The name of the file to delete (can be retrieved from _files field on any document)</td>
</tr>
</tbody></table>

<h1 id="meta-data">Meta Data</h1>

<p>When data is added to the database, we maintain a description of the fields and data types in each collection.</p>

<p>You have the ability to read and update certain metadata details. An example of when you might want to do this is to update security: to mark a field as being readers or authors.</p>

<h2 id="get-meta-data-for-a-collection">Get Meta Data for a collection</h2>

<p>To get a list of all fields that are in a collection, use this method.</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpGet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Get a list of databases that the current user has access to
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="n">JsonJavaArray</span> <span class="nf">getMetaData</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">,</span> <span class="n">String</span> <span class="n">collection</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">loadURL</span><span class="o">(</span><span class="s">"/1.0/metadata/"</span> <span class="o">+</span> <span class="n">dbname</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">collection</span><span class="o">);</span>
    <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
    <span class="n">JsonJavaObject</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaObject</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="na">getAsArray</span><span class="o">(</span><span class="s">"fields"</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to request a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">loadURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpGet</span> <span class="n">httpget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/metadata/'</span> <span class="o">+</span> <span class="nx">dbname</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">collectionname</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
   </span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"53c8cc790e76eee06aed49ba"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"dbname"</span><span class="p">:</span><span class="s2">"dev-londc-com-demos-discussion-nsf"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"collectionname"</span><span class="p">:</span><span class="s2">"MainTopic"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"__v"</span><span class="p">:</span><span class="mi">1</span><span class="p">,</span><span class="w">
   </span><span class="s2">"lastimported"</span><span class="p">:</span><span class="s2">"2014-07-18T07:40:49.632Z"</span><span class="p">,</span><span class="w">
   </span><span class="s2">"fields"</span><span class="p">:[</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="s2">"fieldname"</span><span class="p">:</span><span class="s2">"From"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"53c8cf810e76eee06aed4ad7"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"fieldtype"</span><span class="p">:</span><span class="s2">"Names"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="s2">"fieldname"</span><span class="p">:</span><span class="s2">"AbbreviateFrom"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"53c8cf810e76eee06aed4ad6"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"fieldtype"</span><span class="p">:</span><span class="s2">"String"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="s2">"fieldname"</span><span class="p">:</span><span class="s2">"Current_Status"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"53c8cf810e76eee06aed4ac8"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"fieldtype"</span><span class="p">:</span><span class="s2">"Number"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="s2">"fieldname"</span><span class="p">:</span><span class="s2">"FilebyDate"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"53c8cf810e76eee06aed4ac6"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"fieldtype"</span><span class="p">:</span><span class="s2">"Date"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="s2">"fieldname"</span><span class="p">:</span><span class="s2">"Editors"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"53c8cf810e76eee06aed4abf"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"fieldtype"</span><span class="p">:</span><span class="s2">"Authors"</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="p">{</span><span class="w">
         </span><span class="s2">"fieldname"</span><span class="p">:</span><span class="s2">"readers"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"53c8cf810e76eee06aed4aa2"</span><span class="p">,</span><span class="w">
         </span><span class="s2">"fieldtype"</span><span class="p">:</span><span class="s2">"Readers"</span><span class="w">
      </span><span class="p">}</span><span class="w">
   </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/metadata/:database/:collectionname</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service.</td>
</tr>
<tr>
<td>:collectionname</td>
<td>The name of the collection to get meta data for</td>
</tr>
</tbody></table>

<h2 id="update-meta-data-for-a-collection">Update Meta Data for a Collection</h2>

<p>You can update meta data for a collection with this method. The most common use for this will be to enable and disable readers and authors fields, thus controlling document level security.</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpPost</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.entity.StringEntity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Update Meta Data Field
 *  
 * @param dbname
 * @dbname collection
 * @param fieldname
 * @param fieldtype
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateMetaDataField</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">,</span> <span class="n">String</span> <span class="n">collection</span><span class="o">,</span> <span class="n">String</span> <span class="n">fieldname</span><span class="o">,</span> <span class="n">String</span> <span class="n">fieldtype</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">postURL</span><span class="o">(</span><span class="s">"/1.0/metdata/"</span> <span class="o">+</span> <span class="n">dbname</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">collection</span> <span class="o">+</span> <span class="s">", "</span><span class="o">{</span><span class="err">\</span><span class="s">"fields\": [{\"fieldname\": \""</span> <span class="o">+</span> <span class="n">fieldname</span> <span class="o">+</span> <span class="s">"\", \"fieldtype\": \""</span> <span class="o">+</span> <span class="n">fieldtype</span> <span class="o">+</span> <span class="s">"\"}]}"</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to post data to a URL from the LDC Via service
 * @param url
 * @param data
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">postURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">data</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpPost</span> <span class="n">httppost</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpPost</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>
  <span class="n">StringEntity</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringEntity</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
    <span class="n">input</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">);</span>
    <span class="n">httppost</span><span class="o">.</span><span class="na">setEntity</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
  <span class="n">httppost</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httppost</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"fields"</span><span class="p">:[</span>
    <span class="p">{</span>
      <span class="s2">"fieldname"</span><span class="p">:</span><span class="s2">"From"</span><span class="p">,</span>
      <span class="s2">"fieldtype"</span><span class="p">:</span><span class="s2">"Names"</span>
    <span class="p">}</span>
  <span class="p">]</span>
<span class="p">};</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
  <span class="na">data</span><span class="p">:</span> <span class="nx">data</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/metadata/'</span> <span class="o">+</span> <span class="nx">dbname</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">collectionname</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ok"</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">POST https://eu.ldcvia.com/1.0/metadata/:database/:collectionname</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service.</td>
</tr>
<tr>
<td>:collectionname</td>
<td>The name of the collection to update meta data for</td>
</tr>
</tbody></table>

<h2 id="reset-meta-data-for-a-collection">Reset Meta Data for a Collection</h2>

<p>When data is added to the database, we maintain a description of the fields and data types in each collection. It is possible for this meta data to get out of sync with the data or become corrupt. This method will reset the meta data.</p>

<p>Be aware that if you have set any readers and authors fields in the meta data that these will be reset and thus all document security will be disabled.</p>

<p>Because of this potential, you must be a super user or administrator to run this method.</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpGet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Reset the meta data for a collection
 *  
 * @param dbname
 * @param collection
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">resetMetaData</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">,</span> <span class="n">String</span> <span class="n">collection</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">loadURL</span><span class="o">(</span><span class="s">"/1.0/resetmetadata/"</span> <span class="o">+</span> <span class="n">dbname</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">collection</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to request a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">loadURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpGet</span> <span class="n">httpget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/resetmetadata/'</span> <span class="o">+</span> <span class="nx">dbname</span> <span class="o">+</span> <span class="s2">"/"</span> <span class="o">+</span> <span class="nx">collectionname</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ok"</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/resetmetadata/:database/:collectionname</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service.</td>
</tr>
<tr>
<td>:collectionname</td>
<td>The name of the collection that you want to reset meta data for. By default the meta data will be built using a sampling of the first 100 documents in the collection. If all documents have exactly the same fields on them, then this number can be reduced to improve performance. To change the number of documents sampled, add a URL parameter: &ldquo;&amp;count=n&rdquo;. Likewise, if all documents do not have the same fields on them, then you can increase the sample size using the same technique. Be aware that the larger the sample size, the longer the response will take.</td>
</tr>
</tbody></table>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>count</td>
<td>100</td>
<td>The number of documents to sample for field names</td>
</tr>
</tbody></table>

<h1 id="user-details">User Details</h1>

<p>You can get either your own details of the details of a different user within your organisation. To get you own details omit the :useremail url parameter.</p>

<h2 id="get-your-own-user-details">Get your own user details</h2>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpGet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Get the current user's details
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="n">String</span> <span class="nf">getUserEmail</span><span class="p">(</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">loadURL</span><span class="o">(</span><span class="s">"/1.0/userdetails"</span><span class="o">);</span>
    <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
    <span class="n">JsonJavaObject</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaObject</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="na">getAsString</span><span class="o">(</span><span class="s">"email"</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to request a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">loadURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpGet</span> <span class="n">httpget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/userdetails'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"notesnames"</span><span class="p">:[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"notesname"</span><span class="p">:</span><span class="s2">"CN=Fred Bloggs/O=FCL"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"notesname"</span><span class="p">:</span><span class="s2">"Fred Bloggs"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"notesname"</span><span class="p">:</span><span class="s2">"DocEditors"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"apikey"</span><span class="p">:</span><span class="s2">"hwxsftXnd88KFq"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"username"</span><span class="p">:</span><span class="s2">"Fred Bloggs"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"fred@fclonline.com"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"admin"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="s2">"superuser"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="s2">"databases"</span><span class="p">:[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"database"</span><span class="p">:</span><span class="s2">"dev-londc-com-demos-discussion-nsf"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"53c8cc6e0e76eee06aed497b"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"database"</span><span class="p">:</span><span class="s2">"dev-londc-com-demos-journal-nsf"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"53cecd0819a5ac73b57964e5"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/userdetails</code></p>

<h2 id="get-other-user&#39;s-details">Get other user&rsquo;s details</h2>

<p>The get another user&rsquo;s details, use this method. If you are a super user or the same user as the email address, you will be able to get the API Key, otherwise that will not be returned.</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpGet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Get list of databases visible to another user
 *  
 * @param email
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="n">JsonJavaArray</span> <span class="nf">getUserDatabases</span><span class="p">(</span><span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">loadURL</span><span class="o">(</span><span class="s">"/1.0/userdetails/"</span> <span class="o">+</span> <span class="n">email</span><span class="o">);</span>
    <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
    <span class="n">JsonJavaObject</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaObject</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="na">getAsArray</span><span class="o">(</span><span class="s">"databases"</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to request a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">loadURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpGet</span> <span class="n">httpget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/userdetails/fred@bloggs.com'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"notesnames"</span><span class="p">:[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"notesname"</span><span class="p">:</span><span class="s2">"CN=Fred Bloggs/O=FCL"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"notesname"</span><span class="p">:</span><span class="s2">"Fred Bloggs"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"notesname"</span><span class="p">:</span><span class="s2">"DocEditors"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"group"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">],</span><span class="w">
  </span><span class="s2">"apikey"</span><span class="p">:</span><span class="s2">"hwxsftXnd88KFq"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"username"</span><span class="p">:</span><span class="s2">"Fred Bloggs"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"email"</span><span class="p">:</span><span class="s2">"fred@bloggs.com"</span><span class="p">,</span><span class="w">
  </span><span class="s2">"admin"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="s2">"superuser"</span><span class="p">:</span><span class="kc">false</span><span class="p">,</span><span class="w">
  </span><span class="s2">"databases"</span><span class="p">:[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"database"</span><span class="p">:</span><span class="s2">"dev-londc-com-demos-discussion-nsf"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"53c8cc6e0e76eee06aed497b"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"database"</span><span class="p">:</span><span class="s2">"dev-londc-com-demos-journal-nsf"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"53cecd0819a5ac73b57964e5"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/userdetails/:email</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:email</td>
<td>The email address of the person to get</td>
</tr>
</tbody></table>

<h2 id="add-new-user">Add New User</h2>

<p>In addition to retrieving user details, you can also create users via the API. A POST to create users involves sending an organisation ID, and a collection of user objects.</p>

<p>Once the API has validated the request, for each user two objects will be created: a User and an Account (the two elements maintain a 1:1 relationship, with the Account controlling a user&rsquo;s ability to log in). In addition, all users created will be linked to the passed-in organisation.</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpPost</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.entity.StringEntity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Create a new user
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">createNewUser</span><span class="p">(</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
  <span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="s">"{"</span> <span class="o">+</span>
   <span class="s">"\"organisation\": \"548598c6b283ccf00e5edf43\","</span> <span class="o">+</span>
   <span class="s">"\"users\": ["</span> <span class="o">+</span>
   <span class="s">"{"</span> <span class="o">+</span>
   <span class="s">"\"email\": \"fbloggs@acme.com\","</span> <span class="o">+</span>
   <span class="s">"\"firstname\": \"Fred\","</span> <span class="o">+</span>
   <span class="s">"\"lastname\": \"Bloggs\","</span> <span class="o">+</span>
   <span class="s">"\"notesnames\": ["</span> <span class="o">+</span>
   <span class="s">"{"</span> <span class="o">+</span>
   <span class="s">"\"notesname\": \"test01/acme\""</span> <span class="o">+</span>
   <span class="s">"},"</span> <span class="o">+</span>
   <span class="s">"{"</span> <span class="o">+</span>
   <span class="s">"\"notesname\": \"user01/acme\""</span> <span class="o">+</span>
   <span class="s">"}"</span> <span class="o">+</span>
   <span class="s">"]"</span> <span class="o">+</span>
   <span class="s">"},"</span> <span class="o">+</span>
   <span class="s">"{"</span> <span class="o">+</span>
   <span class="s">"\"email\": \"jh@acme.com\","</span> <span class="o">+</span>
   <span class="s">"\"firstname\": \"Jeremy\","</span> <span class="o">+</span>
   <span class="s">"\"lastname\": \"Hardy\""</span> <span class="o">+</span>
   <span class="s">"}"</span> <span class="o">+</span>
   <span class="s">"]"</span> <span class="o">+</span>
  <span class="s">"}"</span><span class="o">;</span>
    <span class="n">postURL</span><span class="o">(</span><span class="s">"/1.0/users"</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to post data to a URL from the LDC Via service
 * @param url
 * @param data
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">postURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">data</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpPut</span> <span class="n">httppost</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpPost</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>
  <span class="n">StringEntity</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringEntity</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
    <span class="n">input</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">);</span>
    <span class="n">httppost</span><span class="o">.</span><span class="na">setEntity</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
  <span class="n">httppost</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httppost</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
 <span class="s2">"organisation"</span><span class="p">:</span> <span class="s2">"548598c6b283ccf00e5edf43"</span><span class="p">,</span>
 <span class="s2">"users"</span><span class="p">:</span> <span class="p">[</span>
 <span class="p">{</span>
 <span class="s2">"email"</span><span class="p">:</span> <span class="s2">"fbloggs@acme.com"</span><span class="p">,</span>
 <span class="s2">"firstname"</span><span class="p">:</span> <span class="s2">"Fred"</span><span class="p">,</span>
 <span class="s2">"lastname"</span><span class="p">:</span> <span class="s2">"Bloggs"</span><span class="p">,</span>
 <span class="s2">"notesnames"</span><span class="p">:</span> <span class="p">[</span>
 <span class="p">{</span>
 <span class="s2">"notesname"</span><span class="p">:</span> <span class="s2">"test01/acme"</span>
 <span class="p">},</span>
 <span class="p">{</span>
 <span class="s2">"notesname"</span><span class="p">:</span> <span class="s2">"user01/acme"</span>
 <span class="p">}</span>
 <span class="p">]</span>
 <span class="p">},</span>
 <span class="p">{</span>
 <span class="s2">"email"</span><span class="p">:</span> <span class="s2">"jh@acme.com"</span><span class="p">,</span>
 <span class="s2">"firstname"</span><span class="p">:</span> <span class="s2">"Jeremy"</span><span class="p">,</span>
 <span class="s2">"lastname"</span><span class="p">:</span> <span class="s2">"Hardy"</span>
 <span class="p">}</span>
 <span class="p">]</span>
<span class="p">};</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
  <span class="na">data</span><span class="p">:</span> <span class="nx">data</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/users'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ok"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">POST https://eu.ldcvia.com/1.0/users</code></p>

<h2 id="update-users-details">Update Users details</h2>

<p>The update another user&rsquo;s details, use this method. You must be a super user to use this method.</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpPost</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.entity.StringEntity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Update a user
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateUser</span><span class="p">(</span><span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
  <span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="s">"{\r\n  \"notesnames\":\r\n    [\r\n      {\"notesname\": \"CN=Fred Blogs/O=Londc\"},\r\n      {\"notesname\": \"Fred Blogs/Londc\"},\r\n      {\"notesname\": \"Fred Blogs\"},\r\n      {\"notesname\": \"*/Londc\"},\r\n    ]\r\n}"</span><span class="o">;</span>
    <span class="n">postURL</span><span class="o">(</span><span class="s">"/1.0/userdetails/"</span> <span class="o">+</span> <span class="n">email</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to post data to a URL from the LDC Via service
 * @param url
 * @param data
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">postURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">data</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpPut</span> <span class="n">httppost</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpPost</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>
  <span class="n">StringEntity</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringEntity</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
    <span class="n">input</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">);</span>
    <span class="n">httppost</span><span class="o">.</span><span class="na">setEntity</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
  <span class="n">httppost</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httppost</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"notesnames"</span><span class="p">:</span>
    <span class="p">[</span>
      <span class="p">{</span><span class="s2">"notesname"</span><span class="p">:</span> <span class="s2">"CN=Fred Blogs/O=Londc"</span><span class="p">},</span>
      <span class="p">{</span><span class="s2">"notesname"</span><span class="p">:</span> <span class="s2">"Fred Blogs/Londc"</span><span class="p">},</span>
      <span class="p">{</span><span class="s2">"notesname"</span><span class="p">:</span> <span class="s2">"Fred Blogs"</span><span class="p">},</span>
      <span class="p">{</span><span class="s2">"notesname"</span><span class="p">:</span> <span class="s2">"*/Londc"</span><span class="p">},</span>
    <span class="p">]</span>
<span class="p">};</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
  <span class="na">data</span><span class="p">:</span> <span class="nx">data</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/userdetails/fred@bloggs.com'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ok"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">POST https://eu.ldcvia.com/1.0/userdetails/:email</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:email</td>
<td>The email address of the person to update</td>
</tr>
</tbody></table>

<h2 id="delete-user">Delete User</h2>

<p>This method is available for super users to remove another user (you cannot delete yourself!)</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpDelete</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Delete a user
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteUser</span><span class="p">(</span><span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">deleteURL</span><span class="o">(</span><span class="s">"/1.0/userdetails/"</span> <span class="o">+</span> <span class="n">email</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to delete a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">deleteURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpDelete</span> <span class="n">httpdelete</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpDelete</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'DELETE'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/userdetails/fred@bloggs.com'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ok"</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">DELETE https://eu.ldcvia.com/1.0/userdetails/:email</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:email</td>
<td>the email of the person to delete</td>
</tr>
</tbody></table>

<h1 id="access-control">Access Control</h1>

<h2 id="get-list-of-groups-in-organisation">Get list of groups in organisation</h2>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpGet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Get list of groups in organisation
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="n">JsonJavaArray</span> <span class="nf">getGroups</span><span class="p">(</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">loadURL</span><span class="o">(</span><span class="s">"/1.0/groups"</span><span class="o">);</span>
    <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
    <span class="n">JsonJavaArray</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaArray</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>

    <span class="k">return</span> <span class="n">json</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to request a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">loadURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpGet</span> <span class="n">httpget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/groups'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">[</span><span class="s2">"Group 1"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Group 2"</span><span class="p">]</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/groups</code></p>

<h2 id="add-multiple-users-to-group">Add multiple users to group</h2>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpPost</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.entity.StringEntity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Add multiple users to a group
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addUsersToGroup</span><span class="p">(</span><span class="n">String</span> <span class="n">group</span><span class="o">,</span> <span class="n">String</span><span class="o">[]</span> <span class="n">users</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
  <span class="n">var</span> <span class="n">data</span> <span class="o">=</span> <span class="s">"{\"groupname\": \""</span> <span class="o">+</span> <span class="n">group</span><span class="s">"\", \"emails\": ["</span><span class="o">;</span>
  <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">users</span><span class="o">.</span><span class="na">length</span><span class="o">;</span> <span class="n">i</span><span class="o">++){</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="o">){</span>
      <span class="n">data</span> <span class="o">+=</span> <span class="s">", "</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="n">data</span> <span class="o">+=</span> <span class="s">"\""</span> <span class="o">+</span> <span class="n">users</span><span class="o">[</span><span class="n">i</span><span class="o">]</span> <span class="o">+</span> <span class="s">"\""</span><span class="o">;</span>
  <span class="o">}</span>
  <span class="n">data</span> <span class="o">+=</span> <span class="s">"]}"</span>
    <span class="n">postURL</span><span class="o">(</span><span class="s">"/1.0/groups"</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to post data to a URL from the LDC Via service
 * @param url
 * @param data
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">postURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">data</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpPut</span> <span class="n">httppost</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpPost</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>
  <span class="n">StringEntity</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringEntity</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
    <span class="n">input</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">);</span>
    <span class="n">httppost</span><span class="o">.</span><span class="na">setEntity</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
  <span class="n">httppost</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httppost</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
<span class="s2">"groupname"</span><span class="p">:</span><span class="s2">"TestGroup"</span><span class="p">,</span>
<span class="s2">"emails"</span><span class="p">:</span> <span class="p">[</span><span class="s2">"fred@bloggs.com"</span><span class="p">,</span> <span class="s2">"joe@blow.com"</span><span class="p">]</span>
<span class="p">};</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
  <span class="na">data</span><span class="p">:</span> <span class="nx">data</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/groups'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ok"</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">POST https://eu.ldcvia.com/1.0/groups</code></p>

<h2 id="add-single-user-to-group">Add single user to group</h2>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpGet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Add user to a group
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">addUserToGroup</span><span class="p">(</span><span class="n">String</span> <span class="n">group</span><span class="o">,</span> <span class="n">String</span> <span class="n">user</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">loadURL</span><span class="o">(</span><span class="s">"/1.0/groups/"</span> <span class="o">+</span> <span class="n">user</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">group</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to request a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">loadURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpGet</span> <span class="n">httpget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/groups/fred@bloggs.com/Group1'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns 200 Success if the action worked</p>
</blockquote>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/groups/:email/:groupname</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:email</td>
<td>the email of the user to add to the group</td>
</tr>
<tr>
<td>:groupname</td>
<td>the groupname to add the user to</td>
</tr>
</tbody></table>

<h2 id="remove-user-from-group">Remove user from group</h2>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpDelete</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Remove user from a group
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeUserFromGroup</span><span class="p">(</span><span class="n">String</span> <span class="n">group</span><span class="o">,</span> <span class="n">String</span> <span class="n">user</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">deleteURL</span><span class="o">(</span><span class="s">"/1.0/groups/"</span> <span class="o">+</span> <span class="n">user</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">group</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to delete a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">deleteURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpDelete</span> <span class="n">httpdelete</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpDelete</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'DELETE'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/groups/fred@bloggs.com/Group1'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns 200 Success if the action worked</p>
</blockquote>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">DELETE https://eu.ldcvia.com/1.0/groups/:email/:groupname</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:email</td>
<td>the email of the user to remove from the group</td>
</tr>
<tr>
<td>:groupname</td>
<td>the groupname to remove the user from</td>
</tr>
</tbody></table>

<h2 id="get-members-of-group">Get Members of Group</h2>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpGet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Get Members Of a Group
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="n">JsonJavaArray</span> <span class="nf">getGroupMembers</span><span class="p">(</span><span class="n">String</span> <span class="n">group</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">loadURL</span><span class="o">(</span><span class="s">"/1.0/groups/"</span> <span class="o">+</span> <span class="n">group</span><span class="o">);</span>
  <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
  <span class="n">JsonJavaArray</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaArray</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>

  <span class="k">return</span> <span class="n">json</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to request a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">loadURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpGet</span> <span class="n">httpget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/groups/Group1'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns an array of user emails</p>
</blockquote>
<pre><code class="highlight json"><span class="p">[</span><span class="s2">"fred@bloggs.com"</span><span class="p">,</span><span class="w"> </span><span class="s2">"joe@smith.com"</span><span class="p">]</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/groups/:groupname</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:groupname</td>
<td>the groupname to get member list of</td>
</tr>
</tbody></table>

<h2 id="remove-group">Remove Group</h2>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpDelete</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Remove a group
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeGroup</span><span class="p">(</span><span class="n">String</span> <span class="n">group</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">deleteURL</span><span class="o">(</span><span class="s">"/1.0/groups/"</span> <span class="o">+</span> <span class="n">group</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to delete a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">deleteURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpDelete</span> <span class="n">httpdelete</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpDelete</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'DELETE'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/groups/Group1'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns 200 Success if the action worked</p>
</blockquote>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">DELETE https://eu.ldcvia.com/1.0/groups/:groupname</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:groupname</td>
<td>the groupname to delete</td>
</tr>
</tbody></table>

<h2 id="list-all-users-in-organisation">List all users in organisation</h2>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpGet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Get A List of All Users in Organisation
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="n">JsonJavaArray</span> <span class="nf">getAllUsers</span><span class="p">(</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">loadURL</span><span class="o">(</span><span class="s">"/1.0/users"</span><span class="o">);</span>
  <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
  <span class="n">JsonJavaArray</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaArray</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>

  <span class="k">return</span> <span class="n">json</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to request a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">loadURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpGet</span> <span class="n">httpget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/users'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns an array of emails</p>
</blockquote>
<pre><code class="highlight json"><span class="p">[</span><span class="s2">"fred@bloggs.com"</span><span class="p">,</span><span class="w"> </span><span class="s2">"joe@smith.com"</span><span class="p">]</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/users</code></p>

<h2 id="add-user-to-database">Add user to database</h2>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpGet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Add User To Database
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="n">JsonJavaArray</span> <span class="nf">addUserToDatabase</span><span class="p">(</span><span class="n">String</span> <span class="n">email</span><span class="o">,</span> <span class="n">String</span> <span class="n">dbname</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">loadURL</span><span class="o">(</span><span class="s">"/1.0/userdetails/"</span> <span class="o">+</span> <span class="n">email</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">dbname</span><span class="o">);</span>
  <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
  <span class="n">JsonJavaArray</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaArray</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>

  <span class="k">return</span> <span class="n">json</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to request a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">loadURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpGet</span> <span class="n">httpget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/userdetails/joe@bloggs.com/dev-londc-demos-discussion-nsf'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns 200 Success if the operation completed successfully</p>
</blockquote>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/userdetails/:email/:database</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:email</td>
<td>the email of the user to give access to the database</td>
</tr>
<tr>
<td>:database</td>
<td>the database to give the user access to</td>
</tr>
</tbody></table>

<h2 id="remove-user-from-database">Remove user from database</h2>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpDelete</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Remove user from database
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">removeUserFromDatabase</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">,</span> <span class="n">String</span> <span class="n">email</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">deleteURL</span><span class="o">(</span><span class="s">"/1.0/userdetails/"</span> <span class="o">+</span> <span class="n">email</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">dbname</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to delete a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">deleteURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpDelete</span> <span class="n">httpdelete</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpDelete</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'DELETE'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/userdetails/joe@bloggs.com/dev-londc-demos-discussion-nsf'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns 200 Success if the operation completed successfully</p>
</blockquote>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">DELETE https://eu.ldcvia.com/1.0/userdetails/:email/:database</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:email</td>
<td>the email of the user to remove access to the database</td>
</tr>
<tr>
<td>:database</td>
<td>the database to remove the user access to</td>
</tr>
</tbody></table>

<h1 id="utilities">Utilities</h1>

<p>We provide several extra services that act as utilities to make developing applications easier.</p>

<h2 id="get-list-of-distinct-values">Get List of Distinct Values</h2>

<p>Similar in concept to an @DBColumn in Notes, this will return a unique list of values from a field in a collection</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpGet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Get A List of Distinct values from a field in a collection
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="n">JsonJavaArray</span> <span class="nf">getList</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">,</span> <span class="n">String</span> <span class="n">collection</span><span class="o">,</span> <span class="n">String</span> <span class="n">fieldname</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">loadURL</span><span class="o">(</span><span class="s">"/1.0/list/"</span> <span class="o">+</span> <span class="n">dbname</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">collection</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">fieldname</span><span class="o">);</span>
  <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
  <span class="n">JsonJavaArray</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaArray</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>

  <span class="k">return</span> <span class="n">json</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to request a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">loadURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpGet</span> <span class="n">httpget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/list/dev-londc-com-demos-discussion-nsf/MainTopic/Subject'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns an array of items</p>
</blockquote>
<pre><code class="highlight json"><span class="p">[</span><span class="s2">"value one"</span><span class="p">,</span><span class="w"> </span><span class="s2">"value two"</span><span class="p">]</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/list/:database/:collectionname/:fieldname</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>the database to get the value list from</td>
</tr>
<tr>
<td>:collectionname</td>
<td>the collection to get the value list from</td>
</tr>
<tr>
<td>:fieldname</td>
<td>the field to get value list from</td>
</tr>
</tbody></table>

<h2 id="responses">Responses</h2>

<p>Given a database, collection name and document id, this method will return to you a list of collection names and document ids that are responses to this document.</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpGet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Get A List of Response Documents to a Document
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="n">JsonJavaArray</span> <span class="nf">getResponses</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">,</span> <span class="n">String</span> <span class="n">collection</span><span class="o">,</span> <span class="n">String</span> <span class="n">unid</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">loadURL</span><span class="o">(</span><span class="s">"/1.0/responses/"</span> <span class="o">+</span> <span class="n">dbname</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">collection</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">unid</span><span class="o">);</span>
  <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
  <span class="n">JsonJavaArray</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaArray</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>

  <span class="k">return</span> <span class="n">json</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to request a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">loadURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpGet</span> <span class="n">httpget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/responses/dev-londc-com-demos-discussion-nsf/MainTopic/12345678'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The response object is similar to the standard collections response</p>
</blockquote>
<pre><code class="highlight json"><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5411514d8c1fd625dc2ab8c9"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"__unid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A4D2533D7A91573E80257D1900276F8D"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"__parentid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BAB78224CA0B0FEC80257D1900276F91"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"__form"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Response"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5411514e8c1fd625dc2ab8d3"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"__unid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"3411614A3E45C7FB80257D1900276F92"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"__parentid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BAB78224CA0B0FEC80257D1900276F91"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"__form"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ResponseToResponse"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"5411514d8c1fd625dc2ab8c3"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"__unid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"8D58E7A1EFD6899C80257D1900276F8E"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"__parentid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"A4D2533D7A91573E80257D1900276F8D"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"__form"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ResponseToResponse"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/responses/:database/:collectionname/:unid</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service.</td>
</tr>
<tr>
<td>:collectionname</td>
<td>the name of the collection that contains the document</td>
</tr>
<tr>
<td>:unid</td>
<td>the document to get a list of responses for</td>
</tr>
</tbody></table>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:expand</td>
<td>false</td>
<td>If set to true you will be returned an array of documents instead of an array of UNIDs. This can affect performance</td>
</tr>
</tbody></table>

<h3 id="response-properties">Response Properties</h3>

<table><thead>
<tr>
<th>Property</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>_id</td>
<td>the internal reference for the document</td>
</tr>
<tr>
<td>__unid</td>
<td>the unid of the response document</td>
</tr>
<tr>
<td>__parentid</td>
<td>the parentid of the document, this may not be the same as the :unid parameter as this method returns response to responses</td>
</tr>
<tr>
<td>__form</td>
<td>the collection of the response document</td>
</tr>
</tbody></table>

<h2 id="export-to-pdf">Export to PDF</h2>

<p>Given a database, collection name and document id, this method will return PDF with all fields on the document.</p>
<pre><code class="highlight java"><span class="c1">//TODO: Add Sample</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/pdf/dev-londc-com-demos-discussion-nsf/MainTopic/12345678'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns a binary stream of the PDF document</p>
</blockquote>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/pdf/:database/:collectionname/:unid</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service.</td>
</tr>
<tr>
<td>:collectionname</td>
<td>the name of the collection to get the document from</td>
</tr>
<tr>
<td>:unid</td>
<td>the unid of the document to export to PDF</td>
</tr>
</tbody></table>

<h2 id="export-to-eml">Export to EML</h2>

<p>Given a database, collection name and document id, this method will return an EML format file with all fields on the document. This is designed to be used with migrated Domino mail files. It will attempt to run with other files but may not return content.</p>
<pre><code class="highlight java"><span class="c1">//TODO: Add Sample</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/pdf/dev-londc-com-demos-discussion-nsf/MainTopic/12345678'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns a binary stream of the EML document</p>
</blockquote>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/eml/:database/:collectionname/:unid</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service.</td>
</tr>
<tr>
<td>:collectionname</td>
<td>the name of the collection to get the document from</td>
</tr>
<tr>
<td>:unid</td>
<td>the unid of the document to export to EML</td>
</tr>
</tbody></table>

<h2 id="export-to-excel">Export to Excel</h2>

<p>Given a database and collection name, this method will return an Excel spreadsheet list of documents in the collection. The response will contain a list of documents from the collection, you can control how many documents and where in the collection to get them from using URL parameters.</p>

<p>The count of the documents have document level security applied to them, so if there are 100 documents in the collection but the user can see only 10, then the count will be 10.</p>
<pre><code class="highlight java"><span class="c1">//TODO: Add Sample</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/excel/dev-londc-com-demos-discussion-nsf/MainTopic'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns a binary stream of the PDF document</p>
</blockquote>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/excel/:database/:collectionname</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service.</td>
</tr>
<tr>
<td>:collectionname</td>
<td>the name of the collection to export</td>
</tr>
</tbody></table>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>count</td>
<td>500</td>
<td>The number of documents to get data for.</td>
</tr>
<tr>
<td>start</td>
<td>0</td>
<td>The starting position in the view</td>
</tr>
</tbody></table>

<h2 id="doclinks">DocLinks</h2>

<p>Given a database, collection, document and field name, this service will parse the field (it must be a rich text field) and return details of any doclinks that are contained within.</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpGet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Get the details of any doclinks in a rich text field migrated from Domino
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="n">JsonJavaArray</span> <span class="nf">getDocLinks</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">,</span> <span class="n">String</span> <span class="n">collection</span><span class="o">,</span> <span class="n">String</span> <span class="n">unid</span><span class="o">,</span> <span class="n">String</span> <span class="n">fieldname</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">loadURL</span><span class="o">(</span><span class="s">"/1.0/doclink/"</span> <span class="o">+</span> <span class="n">dbname</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">collection</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">unid</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">fieldname</span><span class="o">);</span>
  <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
  <span class="n">JsonJavaArray</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaArray</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>

  <span class="k">return</span> <span class="n">json</span><span class="o">;</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to request a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">loadURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpGet</span> <span class="n">httpget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/doclink/dev-londc-com-demos-discussion-nsf/MainTopic/12345678012345456'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns a JSON object with the parsed doc links (or an empty array if no doc links were found). There are three possible formats, for database links, view links and document links. If the document link is linking to a document in the same database the object will contain the notes:// url and also the apiurl to get the related document. If the document is in a different database then the object will just contain the notes url.</p>
</blockquote>
<pre><code class="highlight json"><span class="p">[</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"notesurl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Notes://Mixed2/80257AC50035BEE2/9B03730C11B24C94852565E20060BED0/BC9F435105F5F9A880257C3100401F50"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"doclink"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"documentid"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BC9F435105F5F9A880257C3100401F50"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"apiurl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"/1.0/document/dev-londc-com-teamstudio-widgets-teamroom-nsf/Response/BC9F435105F5F9A880257C3100401F50"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"notesurl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Notes://Mixed2/80257AC50035BEE2/9B03730C11B24C94852565E20060BED0"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"viewlink"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="p">{</span><span class="w">
    </span><span class="s2">"notesurl"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Notes://Mixed2/80257AC50035BEE2"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"dblink"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">]</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/doclink/:database/:collectionname/:unid/:fieldname</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service.</td>
</tr>
<tr>
<td>:collectionname</td>
<td>the name of the collection to export</td>
</tr>
<tr>
<td>:unid</td>
<td>The unid of the document</td>
</tr>
<tr>
<td>:fieldname</td>
<td>The fieldname to parse for doclinks</td>
</tr>
</tbody></table>

<h2 id="merge-collections">Merge Collections</h2>

<p>Given a database, you have the ability to merge the contents of one collection into another. It can also be used to rename a collection.</p>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
  <span class="na">data</span><span class="p">:</span> <span class="p">{</span><span class="s2">"sourcecollection"</span><span class="p">:</span> <span class="s2">"ResponseToResponse"</span><span class="p">,</span> <span class="s2">"targetcollection"</span><span class="p">:</span> <span class="s2">"Response To Response"</span><span class="p">}</span>
  <span class="nl">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/mergecollections/dev-londc-com-demos-discussion-nsf'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above moves all documents in the ResponseToResponse collection into the Response To Response collection and then returns a JSON object which indicates whether the operation was successful.</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"result"</span><span class="p">:</span><span class="w"> </span><span class="s2">"ok"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/mergecollections/:database</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service.</td>
</tr>
</tbody></table>

<h1 id="audit-trail">Audit Trail</h1>

<p>Every single operation against our API is recorded in our logs. We provide a set of APIs to access those logs for further analysis.</p>

<h2 id="get-all-logs">Get All Logs</h2>

<p>When you want to get a count of activity for your entire environment, use the /activity service. If you want to get detailed logs of activity, then you will need to provide either a database, a database and collection or a database, collection and document id. In all cases, if you issue a GET request then you will be returned all records for that scope.</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpGet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Get A List of Response Documents to a Document
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">getDBActivity</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">loadURL</span><span class="o">(</span><span class="s">"/1.0/activity"</span><span class="o">);</span>
  <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
  <span class="n">JsonJavaObject</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaObject</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>

  <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="n">dbname</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to request a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">loadURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpGet</span> <span class="n">httpget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/activity'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The response object is an object with of counts of logs per database</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
</span><span class="s2">"testdb"</span><span class="p">:</span><span class="mi">1196</span><span class="p">,</span><span class="w">
</span><span class="s2">"192-168-0-13-unpsampler-nsf"</span><span class="p">:</span><span class="mi">39</span><span class="p">,</span><span class="w">
</span><span class="s2">"dev-londc-com-demos-journal-nsf"</span><span class="p">:</span><span class="mi">43</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/activity</code></p>

<h2 id="search-logs">Search Logs</h2>

<p>If you want to further filter the logs to a specific date range or only contain certain messages, for example, then all of the above methods can also be used with POST requests. The responses will be the same format as above. To restrict the logs you can add all of some of the following criteria in a JSON post.</p>

<p>When you want to get a count of activity for your entire environment, use the /activity service. If you want to get detailed logs of activity, then you will need to provide either a database, a database and collection or a database, collection and document id. In all cases, if you issue a GET request then you will be returned all records for that scope.</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpPost</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.entity.StringEntity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Search Activity Logs
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="kt">int</span> <span class="nf">searchLogs</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
  <span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="s">"{"</span> <span class="o">+</span>
    <span class="s">"\"startdate\": {\"year\": 2014, \"month\": 6, \"day\": 1},"</span> <span class="o">+</span>
    <span class="s">"\"enddate\": {\"year\": 2014, \"month\": 7, \"day\": 1},"</span> <span class="o">+</span>
    <span class="s">"\"filters\": ["</span> <span class="o">+</span>
    <span class="s">"  {\"operator\": \"equals\", \"field\": \"level\", \"value\": \"info\"}"</span> <span class="o">+</span>
    <span class="s">"]"</span> <span class="o">+</span>
  <span class="s">"}"</span><span class="o">;</span>
    <span class="n">postURL</span><span class="o">(</span><span class="s">"/1.0/activity"</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
  <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
  <span class="n">JsonJavaObject</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaObject</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>

  <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="na">getInt</span><span class="o">(</span><span class="n">dbname</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to post data to a URL from the LDC Via service
 * @param url
 * @param data
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">postURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">data</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpPut</span> <span class="n">httppost</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpPost</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>
  <span class="n">StringEntity</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringEntity</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
    <span class="n">input</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">);</span>
    <span class="n">httppost</span><span class="o">.</span><span class="na">setEntity</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
  <span class="n">httppost</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httppost</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"startdate"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"year"</span><span class="p">:</span> <span class="mi">2014</span><span class="p">,</span> <span class="s2">"month"</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">"day"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
  <span class="s2">"enddate"</span><span class="err">:</span> <span class="p">{</span><span class="s2">"year"</span><span class="err">:</span> <span class="mi">2014</span><span class="p">,</span> <span class="s2">"month"</span><span class="err">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">"day"</span><span class="err">:</span> <span class="mi">1</span><span class="p">},</span>
  <span class="s2">"filters"</span><span class="err">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"operator"</span><span class="p">:</span> <span class="s2">"equals"</span><span class="p">,</span> <span class="s2">"field"</span><span class="p">:</span> <span class="s2">"level"</span><span class="p">,</span> <span class="s2">"value"</span><span class="p">:</span> <span class="s2">"info"</span><span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
  <span class="na">data</span><span class="p">:</span> <span class="nx">data</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/activity'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The response object is an object with of counts of logs per database</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
</span><span class="s2">"testdb"</span><span class="p">:</span><span class="mi">200</span><span class="p">,</span><span class="w">
</span><span class="s2">"192-168-0-13-unpsampler-nsf"</span><span class="p">:</span><span class="mi">10</span><span class="p">,</span><span class="w">
</span><span class="s2">"dev-londc-com-demos-journal-nsf"</span><span class="p">:</span><span class="mi">0</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">POST https://eu.ldcvia.com/1.0/activity</code></p>

<h2 id="get-single-database-logs">Get Single Database Logs</h2>

<p>To filter logs at a database level, add the database name to the URL structure</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpGet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Get The most recent 30 logs for a database
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="n">JsonJavaArray</span> <span class="nf">getDBActivity</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">loadURL</span><span class="o">(</span><span class="s">"/1.0/activity/"</span> <span class="o">+</span> <span class="n">dbname</span><span class="o">);</span>
  <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
  <span class="n">JsonJavaObject</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaObject</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>

  <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="na">getArray</span><span class="o">(</span><span class="n">docs</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to request a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">loadURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpGet</span> <span class="n">httpget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/activity/dev-londc-com-demos-discussion-nsf?start=0&amp;count=2'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
</span><span class="s2">"count"</span><span class="p">:</span><span class="mi">3901</span><span class="p">,</span><span class="w">
</span><span class="s2">"docs"</span><span class="p">:[</span><span class="w">
</span><span class="p">{</span><span class="w">
</span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"53f22101edf3aa08da052184"</span><span class="p">,</span><span class="w">
</span><span class="s2">"source"</span><span class="p">:</span><span class="s2">"api.v1.js"</span><span class="p">,</span><span class="w">
</span><span class="s2">"db"</span><span class="p">:</span><span class="s2">"dev-londc-com-demos-discussion-nsf"</span><span class="p">,</span><span class="w">
</span><span class="s2">"collection"</span><span class="p">:</span><span class="s2">"MainTopic"</span><span class="p">,</span><span class="w">
</span><span class="s2">"timestamp"</span><span class="p">:</span><span class="s2">"2014-08-18T15:51:29.205Z"</span><span class="p">,</span><span class="w">
</span><span class="s2">"level"</span><span class="p">:</span><span class="s2">"info"</span><span class="p">,</span><span class="w">
</span><span class="s2">"message"</span><span class="p">:</span><span class="s2">"Get Collection"</span><span class="p">,</span><span class="w">
</span><span class="s2">"user"</span><span class="p">:</span><span class="s2">"support@londc.com"</span><span class="w">
</span><span class="p">},</span><span class="w">
</span><span class="p">{</span><span class="w">
</span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"53f22101edf3aa08da052189"</span><span class="p">,</span><span class="w">
</span><span class="s2">"source"</span><span class="p">:</span><span class="s2">"api.v1.js"</span><span class="p">,</span><span class="w">
</span><span class="s2">"db"</span><span class="p">:</span><span class="s2">"dev-londc-com-demos-discussion-nsf"</span><span class="p">,</span><span class="w">
</span><span class="s2">"collection"</span><span class="p">:</span><span class="s2">"MainTopic"</span><span class="p">,</span><span class="w">
</span><span class="s2">"timestamp"</span><span class="p">:</span><span class="s2">"2014-08-18T15:51:29.307Z"</span><span class="p">,</span><span class="w">
</span><span class="s2">"level"</span><span class="p">:</span><span class="s2">"info"</span><span class="p">,</span><span class="w">
</span><span class="s2">"message"</span><span class="p">:</span><span class="s2">"Get Collection"</span><span class="p">,</span><span class="w">
</span><span class="s2">"user"</span><span class="p">:</span><span class="s2">"support@londc.com"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="p">]}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/activity/:database</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service.</td>
</tr>
</tbody></table>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>count</td>
<td>30</td>
<td>The number of documents to get data for.</td>
</tr>
<tr>
<td>start</td>
<td>0</td>
<td>the position in the results to start at</td>
</tr>
</tbody></table>

<h2 id="search-single-database-logs">Search Single Database Logs</h2>

<p>To further filter logs at a database level, add the database name to the URL structure and then POST whatever filters are required</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpPost</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.entity.StringEntity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Search Activity Logs
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="n">JsonJavaArray</span> <span class="nf">searchLogs</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
  <span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="s">"{"</span> <span class="o">+</span>
    <span class="s">"\"startdate\": {\"year\": 2014, \"month\": 6, \"day\": 1},"</span> <span class="o">+</span>
    <span class="s">"\"enddate\": {\"year\": 2014, \"month\": 7, \"day\": 1},"</span> <span class="o">+</span>
    <span class="s">"\"filters\": ["</span> <span class="o">+</span>
    <span class="s">"  {\"operator\": \"equals\", \"field\": \"level\", \"value\": \"info\"}"</span> <span class="o">+</span>
    <span class="s">"]"</span> <span class="o">+</span>
  <span class="s">"}"</span><span class="o">;</span>
    <span class="n">postURL</span><span class="o">(</span><span class="s">"/1.0/activity/"</span> <span class="o">+</span> <span class="n">dbname</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
  <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
  <span class="n">JsonJavaObject</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaObject</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>

  <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="na">getArray</span><span class="o">(</span><span class="s">"docs"</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to post data to a URL from the LDC Via service
 * @param url
 * @param data
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">postURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">data</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpPut</span> <span class="n">httppost</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpPost</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>
  <span class="n">StringEntity</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringEntity</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
    <span class="n">input</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">);</span>
    <span class="n">httppost</span><span class="o">.</span><span class="na">setEntity</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
  <span class="n">httppost</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httppost</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"startdate"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"year"</span><span class="p">:</span> <span class="mi">2014</span><span class="p">,</span> <span class="s2">"month"</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">"day"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
  <span class="s2">"enddate"</span><span class="err">:</span> <span class="p">{</span><span class="s2">"year"</span><span class="err">:</span> <span class="mi">2014</span><span class="p">,</span> <span class="s2">"month"</span><span class="err">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">"day"</span><span class="err">:</span> <span class="mi">1</span><span class="p">},</span>
  <span class="s2">"filters"</span><span class="err">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"operator"</span><span class="p">:</span> <span class="s2">"equals"</span><span class="p">,</span> <span class="s2">"field"</span><span class="p">:</span> <span class="s2">"level"</span><span class="p">,</span> <span class="s2">"value"</span><span class="p">:</span> <span class="s2">"info"</span><span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
  <span class="na">data</span><span class="p">:</span> <span class="nx">data</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/activity'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
</span><span class="s2">"count"</span><span class="p">:</span><span class="mi">205</span><span class="p">,</span><span class="w">
</span><span class="s2">"docs"</span><span class="p">:[</span><span class="w">
</span><span class="p">{</span><span class="w">
</span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"53f22101edf3aa08da052184"</span><span class="p">,</span><span class="w">
</span><span class="s2">"source"</span><span class="p">:</span><span class="s2">"api.v1.js"</span><span class="p">,</span><span class="w">
</span><span class="s2">"db"</span><span class="p">:</span><span class="s2">"dev-londc-com-demos-discussion-nsf"</span><span class="p">,</span><span class="w">
</span><span class="s2">"collection"</span><span class="p">:</span><span class="s2">"MainTopic"</span><span class="p">,</span><span class="w">
</span><span class="s2">"timestamp"</span><span class="p">:</span><span class="s2">"2014-06-18T15:51:29.205Z"</span><span class="p">,</span><span class="w">
</span><span class="s2">"level"</span><span class="p">:</span><span class="s2">"info"</span><span class="p">,</span><span class="w">
</span><span class="s2">"message"</span><span class="p">:</span><span class="s2">"Get Collection"</span><span class="p">,</span><span class="w">
</span><span class="s2">"user"</span><span class="p">:</span><span class="s2">"support@londc.com"</span><span class="w">
</span><span class="p">},</span><span class="w">
</span><span class="p">{</span><span class="w">
</span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"53f22101edf3aa08da052189"</span><span class="p">,</span><span class="w">
</span><span class="s2">"source"</span><span class="p">:</span><span class="s2">"api.v1.js"</span><span class="p">,</span><span class="w">
</span><span class="s2">"db"</span><span class="p">:</span><span class="s2">"dev-londc-com-demos-discussion-nsf"</span><span class="p">,</span><span class="w">
</span><span class="s2">"collection"</span><span class="p">:</span><span class="s2">"MainTopic"</span><span class="p">,</span><span class="w">
</span><span class="s2">"timestamp"</span><span class="p">:</span><span class="s2">"2014-06-18T15:51:29.307Z"</span><span class="p">,</span><span class="w">
</span><span class="s2">"level"</span><span class="p">:</span><span class="s2">"info"</span><span class="p">,</span><span class="w">
</span><span class="s2">"message"</span><span class="p">:</span><span class="s2">"Get Collection"</span><span class="p">,</span><span class="w">
</span><span class="s2">"user"</span><span class="p">:</span><span class="s2">"support@londc.com"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="p">]}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/activity/:database</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service.</td>
</tr>
</tbody></table>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>count</td>
<td>30</td>
<td>The number of documents to get data for.</td>
</tr>
<tr>
<td>start</td>
<td>0</td>
<td>the position in the results to start at</td>
</tr>
</tbody></table>

<h2 id="get-single-collection-logs">Get Single Collection logs</h2>

<p>To filter logs at a collection level, add the database name and collection name to the URL structure</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpGet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Get The most recent 30 logs for a collection
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="n">JsonJavaArray</span> <span class="nf">getCollectionActivity</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">,</span> <span class="n">String</span> <span class="n">collection</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">loadURL</span><span class="o">(</span><span class="s">"/1.0/activity/"</span> <span class="o">+</span> <span class="n">dbname</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">collection</span><span class="o">);</span>
  <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
  <span class="n">JsonJavaObject</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaObject</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>

  <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="na">getArray</span><span class="o">(</span><span class="n">docs</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to request a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">loadURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpGet</span> <span class="n">httpget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/activity/dev-londc-com-demos-discussion-nsf/MainTopic?start=0&amp;count=2'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
</span><span class="s2">"count"</span><span class="p">:</span><span class="mi">3901</span><span class="p">,</span><span class="w">
</span><span class="s2">"docs"</span><span class="p">:[</span><span class="w">
</span><span class="p">{</span><span class="w">
</span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"53f22101edf3aa08da052184"</span><span class="p">,</span><span class="w">
</span><span class="s2">"source"</span><span class="p">:</span><span class="s2">"api.v1.js"</span><span class="p">,</span><span class="w">
</span><span class="s2">"db"</span><span class="p">:</span><span class="s2">"dev-londc-com-demos-discussion-nsf"</span><span class="p">,</span><span class="w">
</span><span class="s2">"collection"</span><span class="p">:</span><span class="s2">"MainTopic"</span><span class="p">,</span><span class="w">
</span><span class="s2">"timestamp"</span><span class="p">:</span><span class="s2">"2014-08-18T15:51:29.205Z"</span><span class="p">,</span><span class="w">
</span><span class="s2">"level"</span><span class="p">:</span><span class="s2">"info"</span><span class="p">,</span><span class="w">
</span><span class="s2">"message"</span><span class="p">:</span><span class="s2">"Get Collection"</span><span class="p">,</span><span class="w">
</span><span class="s2">"user"</span><span class="p">:</span><span class="s2">"support@londc.com"</span><span class="w">
</span><span class="p">},</span><span class="w">
</span><span class="p">{</span><span class="w">
</span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"53f22101edf3aa08da052189"</span><span class="p">,</span><span class="w">
</span><span class="s2">"source"</span><span class="p">:</span><span class="s2">"api.v1.js"</span><span class="p">,</span><span class="w">
</span><span class="s2">"db"</span><span class="p">:</span><span class="s2">"dev-londc-com-demos-discussion-nsf"</span><span class="p">,</span><span class="w">
</span><span class="s2">"collection"</span><span class="p">:</span><span class="s2">"MainTopic"</span><span class="p">,</span><span class="w">
</span><span class="s2">"timestamp"</span><span class="p">:</span><span class="s2">"2014-08-18T15:51:29.307Z"</span><span class="p">,</span><span class="w">
</span><span class="s2">"level"</span><span class="p">:</span><span class="s2">"info"</span><span class="p">,</span><span class="w">
</span><span class="s2">"message"</span><span class="p">:</span><span class="s2">"Get Collection"</span><span class="p">,</span><span class="w">
</span><span class="s2">"user"</span><span class="p">:</span><span class="s2">"support@londc.com"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="p">]}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/activity/:database/:collectionname</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service.</td>
</tr>
<tr>
<td>:collectionname</td>
<td>The name of the collection to get data for</td>
</tr>
</tbody></table>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>count</td>
<td>30</td>
<td>The number of documents to get data for.</td>
</tr>
<tr>
<td>start</td>
<td>0</td>
<td>the position in the results to start at</td>
</tr>
</tbody></table>

<h2 id="search-single-collection-logs">Search Single Collection Logs</h2>

<p>To further filter logs at a collection level, add the database name and collection name to the URL structure and then POST whatever filters are required</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpPost</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.entity.StringEntity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Search Collection Activity Logs
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="n">JsonJavaArray</span> <span class="nf">searchCollectionLogs</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">,</span> <span class="n">String</span> <span class="n">collection</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
  <span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="s">"{"</span> <span class="o">+</span>
    <span class="s">"\"startdate\": {\"year\": 2014, \"month\": 6, \"day\": 1},"</span> <span class="o">+</span>
    <span class="s">"\"enddate\": {\"year\": 2014, \"month\": 7, \"day\": 1},"</span> <span class="o">+</span>
    <span class="s">"\"filters\": ["</span> <span class="o">+</span>
    <span class="s">"  {\"operator\": \"equals\", \"field\": \"level\", \"value\": \"info\"}"</span> <span class="o">+</span>
    <span class="s">"]"</span> <span class="o">+</span>
  <span class="s">"}"</span><span class="o">;</span>
    <span class="n">postURL</span><span class="o">(</span><span class="s">"/1.0/activity/"</span> <span class="o">+</span> <span class="n">dbname</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">collection</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
  <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
  <span class="n">JsonJavaObject</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaObject</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>

  <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="na">getArray</span><span class="o">(</span><span class="s">"docs"</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to post data to a URL from the LDC Via service
 * @param url
 * @param data
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">postURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">data</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpPut</span> <span class="n">httppost</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpPost</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>
  <span class="n">StringEntity</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringEntity</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
    <span class="n">input</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">);</span>
    <span class="n">httppost</span><span class="o">.</span><span class="na">setEntity</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
  <span class="n">httppost</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httppost</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"startdate"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"year"</span><span class="p">:</span> <span class="mi">2014</span><span class="p">,</span> <span class="s2">"month"</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="s2">"day"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
  <span class="s2">"enddate"</span><span class="err">:</span> <span class="p">{</span><span class="s2">"year"</span><span class="err">:</span> <span class="mi">2014</span><span class="p">,</span> <span class="s2">"month"</span><span class="err">:</span> <span class="mi">7</span><span class="p">,</span> <span class="s2">"day"</span><span class="err">:</span> <span class="mi">1</span><span class="p">},</span>
  <span class="s2">"filters"</span><span class="err">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"operator"</span><span class="p">:</span> <span class="s2">"equals"</span><span class="p">,</span> <span class="s2">"field"</span><span class="p">:</span> <span class="s2">"level"</span><span class="p">,</span> <span class="s2">"value"</span><span class="p">:</span> <span class="s2">"info"</span><span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
  <span class="na">data</span><span class="p">:</span> <span class="nx">data</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/activity/dev-londc-com-demos-discussion-nsf/MainTopic?start=0&amp;count=2'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
</span><span class="s2">"count"</span><span class="p">:</span><span class="mi">205</span><span class="p">,</span><span class="w">
</span><span class="s2">"docs"</span><span class="p">:[</span><span class="w">
</span><span class="p">{</span><span class="w">
</span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"53f22101edf3aa08da052184"</span><span class="p">,</span><span class="w">
</span><span class="s2">"source"</span><span class="p">:</span><span class="s2">"api.v1.js"</span><span class="p">,</span><span class="w">
</span><span class="s2">"db"</span><span class="p">:</span><span class="s2">"dev-londc-com-demos-discussion-nsf"</span><span class="p">,</span><span class="w">
</span><span class="s2">"collection"</span><span class="p">:</span><span class="s2">"MainTopic"</span><span class="p">,</span><span class="w">
</span><span class="s2">"timestamp"</span><span class="p">:</span><span class="s2">"2014-06-18T15:51:29.205Z"</span><span class="p">,</span><span class="w">
</span><span class="s2">"level"</span><span class="p">:</span><span class="s2">"info"</span><span class="p">,</span><span class="w">
</span><span class="s2">"message"</span><span class="p">:</span><span class="s2">"Get Collection"</span><span class="p">,</span><span class="w">
</span><span class="s2">"user"</span><span class="p">:</span><span class="s2">"support@londc.com"</span><span class="w">
</span><span class="p">},</span><span class="w">
</span><span class="p">{</span><span class="w">
</span><span class="s2">"_id"</span><span class="p">:</span><span class="s2">"53f22101edf3aa08da052189"</span><span class="p">,</span><span class="w">
</span><span class="s2">"source"</span><span class="p">:</span><span class="s2">"api.v1.js"</span><span class="p">,</span><span class="w">
</span><span class="s2">"db"</span><span class="p">:</span><span class="s2">"dev-londc-com-demos-discussion-nsf"</span><span class="p">,</span><span class="w">
</span><span class="s2">"collection"</span><span class="p">:</span><span class="s2">"MainTopic"</span><span class="p">,</span><span class="w">
</span><span class="s2">"timestamp"</span><span class="p">:</span><span class="s2">"2014-06-18T15:51:29.307Z"</span><span class="p">,</span><span class="w">
</span><span class="s2">"level"</span><span class="p">:</span><span class="s2">"info"</span><span class="p">,</span><span class="w">
</span><span class="s2">"message"</span><span class="p">:</span><span class="s2">"Get Collection"</span><span class="p">,</span><span class="w">
</span><span class="s2">"user"</span><span class="p">:</span><span class="s2">"support@londc.com"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span><span class="p">]}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/activity/:database/:collectionname</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service.</td>
</tr>
<tr>
<td>:collectionname</td>
<td>The name of the collection to look for logs of</td>
</tr>
</tbody></table>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>count</td>
<td>30</td>
<td>The number of documents to get data for.</td>
</tr>
<tr>
<td>start</td>
<td>0</td>
<td>the position in the results to start at</td>
</tr>
</tbody></table>

<h2 id="get-single-document-logs">Get Single Document Logs</h2>

<p>To filter logs at a document level, add the database name, collection name and document unid to the URL structure</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpGet</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Get The most recent 30 logs for a document
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="n">JsonJavaArray</span> <span class="nf">getDocActivity</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">,</span> <span class="n">String</span> <span class="n">collection</span><span class="o">,</span> <span class="n">String</span> <span class="n">unid</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
    <span class="n">String</span> <span class="n">responseBody</span> <span class="o">=</span> <span class="n">loadURL</span><span class="o">(</span><span class="s">"/1.0/activity/"</span> <span class="o">+</span> <span class="n">dbname</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">collection</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">unid</span><span class="o">);</span>
  <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
  <span class="n">JsonJavaObject</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaObject</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>

  <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="na">getArray</span><span class="o">(</span><span class="n">docs</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to request a URL from the LDC Via service
 * @param url
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">loadURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpGet</span> <span class="n">httpget</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpGet</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>

    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
    <span class="n">httpget</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httpget</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'GET'</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/activity/dev-londc-com-demos-discussion-nsf/MainTopic/CBF71C6B10257F5C80257D1900261D7A?start=0&amp;count=2'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">308</span><span class="p">,</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54e59614a969c4da7049c85d"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"collection"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MainTopic"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"document"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CBF71C6B10257F5C80257D1900261D7A"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-02-19T07:51:48.826Z"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"level"</span><span class="p">:</span><span class="w"> </span><span class="s2">"info"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Get Response Heirarchy"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"user"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fred@ldcvia.com"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54e59614a969c4da7049c85c"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"collection"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MainTopic"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"document"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CBF71C6B10257F5C80257D1900261D7A"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-02-19T07:51:48.807Z"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"level"</span><span class="p">:</span><span class="w"> </span><span class="s2">"info"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Get Document"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"user"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fred@ldcvia.com"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/activity/:database/:collectionname/:unid</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service.</td>
</tr>
<tr>
<td>:collectionname</td>
<td>The name of the collection to get the document from</td>
</tr>
<tr>
<td>:unid</td>
<td>The unid of the document to get logs for</td>
</tr>
</tbody></table>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>count</td>
<td>30</td>
<td>The number of documents to get data for.</td>
</tr>
<tr>
<td>start</td>
<td>0</td>
<td>the position in the results to start at</td>
</tr>
</tbody></table>

<h2 id="search-single-document-logs">Search Single Document Logs</h2>

<p>To further filter logs at a document level, add the database name, collection name and document unid to the URL structure and then POST whatever filters are required</p>
<pre><code class="highlight java"><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">ldcvia</span><span class="o">.</span><span class="na">rest</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">java.io.IOException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.io.Serializable</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.ArrayList</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">org.apache.http.HttpEntity</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.HttpResponse</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ClientProtocolException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.ResponseHandler</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.client.methods.HttpPost</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.CloseableHttpClient</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.impl.client.HttpClients</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.util.EntityUtils</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">org.apache.http.entity.StringEntity</span><span class="o">;</span>

<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonException</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaArray</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaFactory</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonJavaObject</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.commons.util.io.json.JsonParser</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.ibm.xsp.extlib.util.ExtLibUtil</span><span class="o">;</span>

<span class="cm">/**
 * Search Document Activity Logs
 *  
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 * @throws JsonException
 */</span>
<span class="kd">public</span> <span class="n">JsonJavaArray</span> <span class="nf">searchDocumentLogs</span><span class="p">(</span><span class="n">String</span> <span class="n">dbname</span><span class="o">,</span> <span class="n">String</span> <span class="n">collection</span><span class="o">,</span> <span class="n">String</span> <span class="n">unid</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span><span class="o">,</span> <span class="n">JsonException</span><span class="o">{</span>
  <span class="n">String</span> <span class="n">data</span> <span class="o">=</span> <span class="s">"{"</span> <span class="o">+</span>
    <span class="s">"\"startdate\": {\"year\": 2014, \"month\": 6, \"day\": 1},"</span> <span class="o">+</span>
    <span class="s">"\"enddate\": {\"year\": 2014, \"month\": 7, \"day\": 1},"</span> <span class="o">+</span>
    <span class="s">"\"filters\": ["</span> <span class="o">+</span>
    <span class="s">"  {\"operator\": \"equals\", \"field\": \"level\", \"value\": \"info\"}"</span> <span class="o">+</span>
    <span class="s">"]"</span> <span class="o">+</span>
  <span class="s">"}"</span><span class="o">;</span>
    <span class="n">postURL</span><span class="o">(</span><span class="s">"/1.0/activity/"</span> <span class="o">+</span> <span class="n">dbname</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">collection</span> <span class="o">+</span> <span class="s">"/"</span> <span class="o">+</span> <span class="n">unid</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
  <span class="n">JsonJavaFactory</span> <span class="n">factory</span> <span class="o">=</span> <span class="n">JsonJavaFactory</span><span class="o">.</span><span class="na">instanceEx</span><span class="o">;</span>
  <span class="n">JsonJavaObject</span> <span class="n">json</span> <span class="o">=</span> <span class="o">(</span><span class="n">JsonJavaObject</span><span class="o">)</span> <span class="n">JsonParser</span><span class="o">.</span><span class="na">fromJson</span><span class="o">(</span><span class="n">factory</span><span class="o">,</span> <span class="n">responseBody</span><span class="o">);</span>

  <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="na">getArray</span><span class="o">(</span><span class="s">"docs"</span><span class="o">);</span>
<span class="o">}</span>

<span class="cm">/**
 * Helper method to post data to a URL from the LDC Via service
 * @param url
 * @param data
 * @return
 * @throws ClientProtocolException
 * @throws IOException
 */</span>
<span class="kd">private</span> <span class="n">String</span> <span class="nf">postURL</span><span class="p">(</span><span class="n">String</span> <span class="n">url</span><span class="o">,</span> <span class="n">String</span> <span class="n">data</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
    <span class="n">CloseableHttpClient</span> <span class="n">httpclient</span> <span class="o">=</span> <span class="n">HttpClients</span><span class="o">.</span><span class="na">createDefault</span><span class="o">();</span>
    <span class="n">HttpPut</span> <span class="n">httppost</span> <span class="o">=</span> <span class="k">new</span> <span class="n">HttpPost</span><span class="o">(</span><span class="k">this</span><span class="o">.</span><span class="na">baseurl</span> <span class="o">+</span> <span class="n">url</span><span class="o">);</span>
  <span class="n">StringEntity</span> <span class="n">input</span> <span class="o">=</span> <span class="k">new</span> <span class="n">StringEntity</span><span class="o">(</span><span class="n">data</span><span class="o">);</span>
    <span class="n">input</span><span class="o">.</span><span class="na">setContentType</span><span class="o">(</span><span class="s">"application/json"</span><span class="o">);</span>
    <span class="n">httppost</span><span class="o">.</span><span class="na">setEntity</span><span class="o">(</span><span class="n">input</span><span class="o">);</span>
    <span class="c1">// Create a custom response handler</span>
    <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">responseHandler</span> <span class="o">=</span> <span class="k">new</span> <span class="n">ResponseHandler</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;()</span> <span class="o">{</span>

        <span class="kd">public</span> <span class="n">String</span> <span class="n">handleResponse</span><span class="o">(</span><span class="kd">final</span> <span class="n">HttpResponse</span> <span class="n">response</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClientProtocolException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
            <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getStatusLine</span><span class="o">().</span><span class="na">getStatusCode</span><span class="o">();</span>
            <span class="k">if</span> <span class="o">(</span><span class="n">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="n">status</span> <span class="o">&lt;</span> <span class="mi">300</span><span class="o">)</span> <span class="o">{</span>
                <span class="n">HttpEntity</span> <span class="n">entity</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getEntity</span><span class="o">();</span>
                <span class="k">return</span> <span class="n">entity</span> <span class="o">!=</span> <span class="kc">null</span> <span class="o">?</span> <span class="n">EntityUtils</span><span class="o">.</span><span class="na">toString</span><span class="o">(</span><span class="n">entity</span><span class="o">)</span> <span class="o">:</span> <span class="kc">null</span><span class="o">;</span>
            <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
                <span class="k">throw</span> <span class="k">new</span> <span class="n">ClientProtocolException</span><span class="o">(</span><span class="s">"Unexpected response status: "</span> <span class="o">+</span> <span class="n">status</span><span class="o">);</span>
            <span class="o">}</span>
        <span class="o">}</span>

    <span class="o">};</span>
  <span class="n">httppost</span><span class="o">.</span><span class="na">addHeader</span><span class="o">(</span><span class="s">"apikey"</span><span class="o">,</span> <span class="s">"MYSECRETAPIKEY"</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">httpclient</span><span class="o">.</span><span class="na">execute</span><span class="o">(</span><span class="n">httppost</span><span class="o">,</span> <span class="n">responseHandler</span><span class="o">);</span>
<span class="o">}</span>
</code></pre>
<pre><code class="highlight javascript"><span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
  <span class="s2">"startdate"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"year"</span><span class="p">:</span> <span class="mi">2015</span><span class="p">,</span> <span class="s2">"month"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s2">"day"</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
  <span class="s2">"enddate"</span><span class="err">:</span> <span class="p">{</span><span class="s2">"year"</span><span class="err">:</span> <span class="mi">2014</span><span class="p">,</span> <span class="s2">"month"</span><span class="err">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s2">"day"</span><span class="err">:</span> <span class="mi">1</span><span class="p">},</span>
  <span class="s2">"filters"</span><span class="err">:</span> <span class="p">[</span>
    <span class="p">{</span><span class="s2">"operator"</span><span class="p">:</span> <span class="s2">"equals"</span><span class="p">,</span> <span class="s2">"field"</span><span class="p">:</span> <span class="s2">"level"</span><span class="p">,</span> <span class="s2">"value"</span><span class="p">:</span> <span class="s2">"info"</span><span class="p">}</span>
  <span class="p">]</span>
<span class="p">}</span>
<span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
  <span class="na">dataType</span><span class="p">:</span> <span class="s1">'json'</span><span class="p">,</span>
  <span class="na">type</span><span class="p">:</span> <span class="s1">'POST'</span><span class="p">,</span>
  <span class="na">data</span><span class="p">:</span> <span class="nx">data</span><span class="p">,</span>
  <span class="na">headers</span><span class="p">:</span> <span class="p">{</span>
    <span class="s1">'apikey'</span><span class="p">:</span> <span class="nx">apikey</span>
  <span class="p">},</span>
  <span class="na">url</span><span class="p">:</span> <span class="s1">'/1.0/activity/dev-londc-com-demos-discussion-nsf/MainTopic/CBF71C6B10257F5C80257D1900261D7A?start=0&amp;count=2'</span><span class="p">,</span>
  <span class="na">success</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">//Do Something</span>
  <span class="p">}</span>
<span class="p">})</span>
</code></pre>

<blockquote>
<p>The above returns JSON structured like this:</p>
</blockquote>
<pre><code class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"count"</span><span class="p">:</span><span class="w"> </span><span class="mi">308</span><span class="p">,</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54e59614a969c4da7049c85d"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"collection"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MainTopic"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"document"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CBF71C6B10257F5C80257D1900261D7A"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-02-19T07:51:48.826Z"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"level"</span><span class="p">:</span><span class="w"> </span><span class="s2">"info"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Get Response Heirarchy"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"user"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fred@ldcvia.com"</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="s2">"_id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"54e59614a969c4da7049c85c"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"collection"</span><span class="p">:</span><span class="w"> </span><span class="s2">"MainTopic"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"document"</span><span class="p">:</span><span class="w"> </span><span class="s2">"CBF71C6B10257F5C80257D1900261D7A"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"timestamp"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2015-02-19T07:51:48.807Z"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"level"</span><span class="p">:</span><span class="w"> </span><span class="s2">"info"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Get Document"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"user"</span><span class="p">:</span><span class="w"> </span><span class="s2">"fred@ldcvia.com"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>

<h3 id="http-request">HTTP Request</h3>

<p><code class="prettyprint">GET https://eu.ldcvia.com/1.0/activity/:database/:collectionname/:unid</code></p>

<h3 id="url-parameters">URL Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>:database</td>
<td>This is the unique name of the database which can be accessed using the databases service.</td>
</tr>
<tr>
<td>:collectionname</td>
<td>The name of the collection containing the document to look for logs of</td>
</tr>
<tr>
<td>:unid</td>
<td>The unid of the document to look for logs of</td>
</tr>
</tbody></table>

<h3 id="query-parameters">Query Parameters</h3>

<table><thead>
<tr>
<th>Parameter</th>
<th>Default</th>
<th>Description</th>
</tr>
</thead><tbody>
<tr>
<td>count</td>
<td>30</td>
<td>The number of documents to get data for.</td>
</tr>
<tr>
<td>start</td>
<td>0</td>
<td>the position in the results to start at</td>
</tr>
</tbody></table>

          <h1 id="errors">Errors</h1>

<aside class="notice">This error section is stored in a separate file in `includes/_errors.md`. Slate allows you to optionally separate out your docs into many files&hellip;just save them to the `includes` folder and add them to the top of your `index.md`&rsquo;s frontmatter. Files are included in the order listed.</aside>

<p>The LDC Via API uses the following error codes:</p>

<table><thead>
<tr>
<th>Error Code</th>
<th>Meaning</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>Bad Request &ndash; Your request sucks</td>
</tr>
<tr>
<td>401</td>
<td>Unauthorized &ndash; Your API key is wrong</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden &ndash; The page requested is not available to you</td>
</tr>
<tr>
<td>404</td>
<td>Not Found &ndash; The specified page could not be found</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed &ndash; You tried to access a page with an invalid method</td>
</tr>
<tr>
<td>406</td>
<td>Not Acceptable &ndash; You requested a format that isn&rsquo;t json</td>
</tr>
<tr>
<td>410</td>
<td>Gone &ndash; The page requested has been removed from our servers</td>
</tr>
<tr>
<td>418</td>
<td>I&rsquo;m a teapot</td>
</tr>
<tr>
<td>429</td>
<td>Too Many Requests &ndash; You&rsquo;re requesting too many pages! Slown down!</td>
</tr>
<tr>
<td>500</td>
<td>Internal Server Error &ndash; We had a problem with our server. Try again later.</td>
</tr>
<tr>
<td>503</td>
<td>Service Unavailable &ndash; We&rsquo;re temporarially offline for maintanance. Please try again later.</td>
</tr>
</tbody></table>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="java">java</a>
                <a href="#" data-language-name="javascript">javascript</a>
          </div>
      </div>
    </div>
  </body>
</html>
